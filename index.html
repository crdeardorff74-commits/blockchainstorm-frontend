<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>TaNTЯiS</title>
	
	<meta name="description" content="Play TaNTЯiS, a revolutionary twist on classic Tetris. Journey through the solar system, survive cosmic disasters, and compete on global leaderboards. Free browser game.">
	<meta name="keywords" content="Tetris, block puzzle game, falling blocks, free online game, browser game, puzzle game, AI game, space game">
	<meta name="robots" content="index, follow">
	<link rel="canonical" href="https://blockchainstorm.official-intelligence.art/">

	<!-- Open Graph -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://tantris.official-intelligence.art/">
	<meta property="og:title" content="TaNTЯiS - Free Online Falling Blocks Game">
	<meta property="og:description" content="A revolutionary twist on classic Tetris. Journey through the solar system, survive cosmic disasters, and compete on global leaderboards.">
	<meta property="og:image" content="https://res.cloudinary.com/dzlhmwvlx/image/upload/v1764977477/BLOCKCHaiNSTO%D0%AFM_thumb_pceyvy.png">

	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="TaNTЯiS - Free Online Falling Blocks Game">
	<meta name="twitter:description" content="A revolutionary twist on classic Tetris. Journey through the solar system and compete on global leaderboards.">
	<meta name="twitter:image" content="https://res.cloudinary.com/dzlhmwvlx/image/upload/v1764977477/BLOCKCHaiNSTO%D0%AFM_thumb_pceyvy.png">
    
    <!-- iOS Standalone Mode (Add to Home Screen) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaNTЯiS">
    
    <!-- Android/Chrome PWA -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
        }
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            min-height: 100%;
            z-index: 0;
            display: block;
            object-fit: fill;
            border: none;
            margin: 0;
            padding: 0;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4vh 1vw 1vh 1vw;
            position: relative;
            z-index: 1;
            height: 7vh;
            box-sizing: border-box;
        }
        .title {
            font-size: 3.5vh;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            letter-spacing: 0.3vh;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 0.2vh 0.4vh rgba(255, 215, 0, 0.5))
                    drop-shadow(0 0.4vh 0.8vh rgba(0, 0, 0, 0.7));
            animation: titlePulse 3s ease-in-out infinite;
        }
        @keyframes titlePulse {
            0%, 100% { 
                filter: drop-shadow(0 0.2vh 0.4vh rgba(255, 215, 0, 0.5))
                        drop-shadow(0 0.4vh 0.8vh rgba(0, 0, 0, 0.7));
            }
            50% { 
                filter: drop-shadow(0 0.3vh 0.6vh rgba(255, 215, 0, 0.8))
                        drop-shadow(0 0.4vh 0.8vh rgba(0, 0, 0, 0.7));
            }
        }
        .content-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 0 2vw 1vh 2vw;
            position: relative;
            z-index: 1;
            height: calc(93vh - 7vh);
            box-sizing: border-box;
            width: 100%;
            overflow: hidden; /* Prevent overflow */
        }
        .game-container {
            display: flex;
            justify-content: space-between; /* Space between panels */
            align-items: flex-start;
            gap: 2vw; /* Larger gap between panels */
            position: relative;
            z-index: 1;
            height: 100%;
            max-height: 88vh;
            width: 100%; /* Use full width */
            max-width: 100%; /* Prevent overflow */
            margin: 0 auto;
            box-sizing: border-box;
        }
        .main-area {
            background: transparent;
            padding: 0;
            border-radius: 1vh;
            position: relative;
            height: 88vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
            flex-shrink: 0; /* Prevent shrinking */
            flex-grow: 1; /* Allow growing to take available space */
            min-width: 0; /* Allow shrinking below content width */
            overflow: hidden; /* Prevent content from extending beyond bounds */
        }
        /* Allow tooltip overflow when mode menu is visible */
        .main-area:has(.mode-menu:not(.hidden)) {
            overflow: visible;
        }
        canvas {
            border: 0.3vh solid rgba(255, 255, 255, 0.5);
            display: block;
            background: transparent;
            box-shadow: 0 0 2vh rgba(0, 0, 0, 0.5);
            max-height: 88vh;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .vineOverlay {
            border: none !important;
            box-shadow: none !important;
            max-height: none !important;
            transition: none !important;
            pointer-events: none !important;
        }
        .vineWrapper {
            display: inline-block;
            position: relative;
            pointer-events: none;
        }
        .vineWrapper > canvas:first-child {
            pointer-events: auto;
        }
        canvas.tsunami-active {
            border-color: gold;
            box-shadow: 0 0 3vh rgba(255, 215, 0, 0.8), 0 0 1vh rgba(255, 215, 0, 0.6);
            animation: tsunamiPulse 0.5s ease-in-out infinite alternate;
        }
        @keyframes tsunamiPulse {
            from {
                box-shadow: 0 0 3vh rgba(255, 215, 0, 0.8), 0 0 1vh rgba(255, 215, 0, 0.6);
            }
            to {
                box-shadow: 0 0 4vh rgba(255, 215, 0, 1), 0 0 2vh rgba(255, 215, 0, 0.8);
            }
        }
        canvas.blackhole-active {
            border-color: #8b00ff;
            box-shadow: 0 0 3vh rgba(139, 0, 255, 0.9), 0 0 1.5vh rgba(75, 0, 130, 0.7);
            animation: blackholePulse 0.4s ease-in-out infinite alternate;
        }
        @keyframes blackholePulse {
            from {
                box-shadow: 0 0 3vh rgba(139, 0, 255, 0.9), 0 0 1.5vh rgba(75, 0, 130, 0.7);
            }
            to {
                box-shadow: 0 0 5vh rgba(139, 0, 255, 1), 0 0 3vh rgba(75, 0, 130, 0.9), inset 0 0 2vh rgba(139, 0, 255, 0.5);
            }
        }
        canvas.touchdown-active {
            border-color: #00ff00;
            box-shadow: 0 0 3vh rgba(0, 255, 0, 0.9), 0 0 2vh rgba(0, 200, 0, 0.7);
            animation: touchdownPulse 0.3s ease-in-out infinite alternate;
        }
        @keyframes touchdownPulse {
            from {
                box-shadow: 0 0 3vh rgba(0, 255, 0, 0.9), 0 0 2vh rgba(0, 200, 0, 0.7);
            }
            to {
                box-shadow: 0 0 6vh rgba(0, 255, 0, 1), 0 0 4vh rgba(0, 200, 0, 0.9), inset 0 0 2vh rgba(0, 255, 0, 0.5);
            }
        }
        
        /* Nervous mode shake animation */
        @keyframes nervousShake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-0.5vh, 0.3vh); }
            20% { transform: translate(0.6vh, -0.4vh); }
            30% { transform: translate(-0.4vh, 0.6vh); }
            40% { transform: translate(0.5vh, -0.3vh); }
            50% { transform: translate(-0.6vh, 0.4vh); }
            60% { transform: translate(0.3vh, -0.6vh); }
            70% { transform: translate(-0.4vh, 0.3vh); }
            80% { transform: translate(0.6vh, -0.5vh); }
            90% { transform: translate(-0.3vh, 0.5vh); }
        }
        
        @keyframes nervousShakeLongAgo {
            0%, 100% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(0, 0); }
            10% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(-0.5vh, 0.3vh); }
            20% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(0.6vh, -0.4vh); }
            30% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(-0.4vh, 0.6vh); }
            40% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(0.5vh, -0.3vh); }
            50% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(-0.6vh, 0.4vh); }
            60% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(0.3vh, -0.6vh); }
            70% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(-0.4vh, 0.3vh); }
            80% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(0.6vh, -0.5vh); }
            90% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translate(-0.3vh, 0.5vh); }
        }
        
        @keyframes nervousShakeComingSoon {
            0%, 100% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(0, 0); }
            10% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(-0.5vh, 0.3vh); }
            20% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(0.6vh, -0.4vh); }
            30% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(-0.4vh, 0.6vh); }
            40% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(0.5vh, -0.3vh); }
            50% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(-0.6vh, 0.4vh); }
            60% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(0.3vh, -0.6vh); }
            70% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(-0.4vh, 0.3vh); }
            80% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(0.6vh, -0.5vh); }
            90% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translate(-0.3vh, 0.5vh); }
        }
        
        canvas.nervous-active {
            animation: nervousShake 0.1s infinite linear;
        }
        
        /* When both Nervous and Long Ago are active */
        canvas.nervous-active.longago-mode {
            animation: nervousShakeLongAgo 0.1s infinite linear;
        }
        
        /* When both Nervous and Coming Soon are active */
        canvas.nervous-active.comingsoon-mode {
            animation: nervousShakeComingSoon 0.1s infinite linear;
        }
        
        /* When both Nervous and Thinner are active */
        @keyframes nervousShakeThinner {
            0%, 100% { transform: scaleX(0.6) translateX(0); }
            25% { transform: scaleX(0.6) translateX(-0.3vh); }
            75% { transform: scaleX(0.6) translateX(0.3vh); }
        }
        
        canvas.nervous-active.thinner-mode {
            animation: nervousShakeThinner 0.1s infinite linear;
        }
        
        /* When both Nervous and Thicker are active */
        @keyframes nervousShakeThicker {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-0.3vh); }
            75% { transform: translateX(0.3vh); }
        }
        
        canvas.nervous-active.thicker-mode {
            animation: nervousShakeThicker 0.1s infinite linear;
        }
        
        /* Three-way combinations: Nervous + Thinner + Long Ago */
        @keyframes nervousShakeThinnerLongAgo {
            0%, 100% { transform: perspective(800px) rotateX(45deg) scaleX(0.6) scale(1.5) translateY(-25%) translateX(0); }
            25% { transform: perspective(800px) rotateX(45deg) scaleX(0.6) scale(1.5) translateY(-25%) translateX(-0.3vh); }
            75% { transform: perspective(800px) rotateX(45deg) scaleX(0.6) scale(1.5) translateY(-25%) translateX(0.3vh); }
        }
        
        canvas.nervous-active.thinner-mode.longago-mode {
            animation: nervousShakeThinnerLongAgo 0.1s infinite linear;
        }
        
        /* Three-way combinations: Nervous + Thinner + Coming Soon */
        @keyframes nervousShakeThinnerComingSoon {
            0%, 100% { transform: perspective(800px) rotateX(-45deg) scaleX(0.6) scale(1.5) translateY(25%) translateX(0); }
            25% { transform: perspective(800px) rotateX(-45deg) scaleX(0.6) scale(1.5) translateY(25%) translateX(-0.3vh); }
            75% { transform: perspective(800px) rotateX(-45deg) scaleX(0.6) scale(1.5) translateY(25%) translateX(0.3vh); }
        }
        
        canvas.nervous-active.thinner-mode.comingsoon-mode {
            animation: nervousShakeThinnerComingSoon 0.1s infinite linear;
        }
        
        /* Three-way combinations: Nervous + Thicker + Long Ago */
        @keyframes nervousShakeThickerLongAgo {
            0%, 100% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translateX(0); }
            25% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translateX(-0.3vh); }
            75% { transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%) translateX(0.3vh); }
        }
        
        canvas.nervous-active.thicker-mode.longago-mode {
            animation: nervousShakeThickerLongAgo 0.1s infinite linear;
        }
        
        /* Three-way combinations: Nervous + Thicker + Coming Soon */
        @keyframes nervousShakeThickerComingSoon {
            0%, 100% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translateX(0); }
            25% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translateX(-0.3vh); }
            75% { transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%) translateX(0.3vh); }
        }
        
        canvas.nervous-active.thicker-mode.comingsoon-mode {
            animation: nervousShakeThickerComingSoon 0.1s infinite linear;
        }
        
        .side-panel {
            background: rgba(30, 60, 120, 0.35);
            padding: 2vh 1.5vw;
            border-radius: 1vh;
            color: white;
            width: 22vw;
            min-width: 220px;
            max-width: 27vw;
            display: flex;
            flex-direction: column;
            height: 88vh;
            box-sizing: border-box;
            font-size: 1.8vh;
            position: relative;
            flex-shrink: 1; /* Allow some shrinking if needed */
            flex-grow: 0; /* Don't grow */
            transition: right 0.3s ease, width 0.3s ease;
        }
        
        /* Responsive adjustments for smaller screens */
        @media (max-width: 1400px) {
            .rules-panel, .side-panel {
                width: 20vw;
                min-width: 180px;
            }
            .game-container {
                gap: 1vw;
            }
        }
        
        @media (max-width: 1200px) {
            .rules-panel, .side-panel {
                width: 18vw;
                min-width: 150px;
                font-size: 1.3vh;
            }
            .game-container {
                gap: 0.5vw;
            }
        }
        
        /* Tablet mode - 50% wider panels */
        body.tablet-mode .rules-panel,
        body.tablet-mode .side-panel {
            width: 33vw;
            min-width: 280px;
            max-width: 40vw;
            overflow: visible;
        }
        
        /* Ensure touch controls fit within panel in tablet mode */
        body.tablet-mode #touchControls {
            margin-top: 0.5vh;
            max-height: 20vh;
        }
        
        body.tablet-mode .touch-btn {
            min-height: 4.5vh;
            max-height: 6vh;
        }
        
        /* Minimalist mode styles */
        body.minimalist-mode .rules-panel {
            background: transparent !important;
            box-shadow: none !important;
        }
        
        body.minimalist-mode .rules-instructions {
            display: none !important;
        }
        
        body.minimalist-mode .side-panel {
            background: transparent !important;
            box-shadow: none !important;
        }
        
        body.minimalist-mode .side-panel > *:not(.score-display:first-child):not(.next-piece) {
            display: none !important;
        }
        
        body.minimalist-mode .side-panel .score-display:first-child {
            visibility: hidden !important;
        }
        
        body.minimalist-mode.game-started .side-panel .score-display:first-child {
            visibility: visible !important;
        }
        
        body.minimalist-mode .side-panel .score-display:first-child .score-label {
            display: none !important;
        }
        
        body.minimalist-mode .side-panel .score-display:first-child #score {
            font-size: 3vh !important;
        }
        
        body.minimalist-mode .next-piece .score-label {
            display: none !important;
        }
        
        body.minimalist-mode .next-canvas {
            background: transparent !important;
            box-shadow: none !important;
        }
        
        body.minimalist-mode.game-running .header {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Global custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.5);
        }
        
        .rules-panel {
            background: rgba(30, 60, 120, 0.35);
            padding: 2vh 1vw;
            border-radius: 1vh;
            color: white;
            width: 22vw;
            min-width: 220px;
            max-width: 27vw;
            height: 88vh;
            box-sizing: border-box;
            overflow: visible; /* Allow tick labels to extend past edge */
            font-size: 1.4vh;
            display: flex;
            flex-direction: column;
            gap: 1vh;
            position: relative;
            z-index: 5; /* Ensure panel is above other elements */
            flex-shrink: 1; /* Allow some shrinking if needed */
            flex-grow: 0; /* Don't grow */
            transition: left 0.3s ease, width 0.3s ease;
        }
        
        .rules-instructions {
            display: block;
            overflow-y: auto; /* Only instructions can scroll if needed */
            flex-shrink: 1; /* Allow instructions to shrink when histogram/stats appear */
            max-height: 100%; /* Can take full height when alone */
        }
        
        /* When histogram is visible, limit instructions height */
        .rules-panel:has(.histogram-canvas[style*="display: block"]) .rules-instructions {
            max-height: 0;
            overflow: hidden;
            padding: 0;
            margin: 0;
        }
        .histogram-canvas {
            width: 100%;
            flex: 1; /* Take available space */
            min-height: 30vh; /* Ensure minimum height for histograms */
            display: none; /* Hidden by default, shown during gameplay */
            border: none; /* Remove any border */
            box-shadow: none; /* Remove drop shadow */
            background: transparent; /* Explicit transparent background */
        }
        
        /* Touch Controls for Tablet Mode */
        #touchControls {
            display: none; /* Hidden by default, shown in tablet mode */
            grid-template-columns: repeat(6, 1fr); /* 6 columns for easy 50/50 bottom split */
            grid-template-rows: auto auto auto;
            column-gap: 0.5vh; /* Horizontal gap between buttons */
            row-gap: 0.5vh; /* Match vertical gap to horizontal */
            padding: 0.5vh;
            margin-top: 1vh;
            height: auto;
            max-height: 22vh;
        }
        
        .touch-btn {
            background: rgba(30, 60, 120, 0.9);
            border: 0.3vh solid rgba(255, 255, 255, 0.6);
            border-radius: 0.8vh;
            color: white;
            font-size: 3.2vh;
            font-weight: bold;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            transition: all 0.1s;
            padding: 0;
            min-height: 5vh;
            max-height: 6.5vh;
        }
        
        .touch-btn:active {
            background: rgba(50, 100, 180, 1);
            border-color: #FFD700;
            transform: scale(0.95);
        }
        
        /* Row 1: Single ROTATE CCW button spanning all 6 columns */
        .touch-btn.touch-btn-rotate-ccw {
            grid-column: 1 / 7;
            grid-row: 1 / 2;
        }
        
        /* Row 2: Three buttons, each spanning 2 columns (2+2+2 = 6) */
        .touch-btn.touch-btn-left {
            grid-column: 1 / 3;
            grid-row: 2 / 3;
        }
        
        .touch-btn.touch-btn-rotate {
            grid-column: 3 / 5;
            grid-row: 2 / 3;
        }
        
        .touch-btn.touch-btn-right {
            grid-column: 5 / 7;
            grid-row: 2 / 3;
        }
        
        /* Row 3: Two buttons, each spanning 3 columns (3+3 = 6, perfect 50/50 split) */
        .touch-btn.touch-btn-down {
            grid-column: 1 / 4;
            grid-row: 3 / 4;
        }
        
        .touch-btn.touch-btn-drop {
            grid-column: 4 / 7;
            grid-row: 3 / 4;
        }
        
        /* Pause Button (top-right corner during tablet mode gameplay) */
        .pause-btn {
            display: none; /* Hidden by default */
            position: absolute;
            top: 1vh;
            right: 1.5vw;
            padding: 1vh 1.5vw;
            font-size: 2.5vh;
            background: rgba(30, 60, 120, 0.9);
            color: white;
            border: 0.3vh solid rgba(255, 255, 255, 0.6);
            border-radius: 0.8vh;
            cursor: pointer;
            transition: all 0.1s;
            z-index: 9999;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .pause-btn:hover {
            background: rgba(50, 100, 180, 1);
            border-color: #FFD700;
        }
        
        .pause-btn:active {
            transform: scale(0.95);
        }
        
        /* Planet Stats in Left Panel (Tablet Mode) */
        #planetStatsLeft {
            display: none; /* Hidden by default, shown in tablet mode */
            margin-top: 0;
            padding: 0.6vh 0.6vw;
            background: rgba(20, 40, 80, 0.9);
            border-radius: 0.5vh;
            border: 0.2vh solid rgba(255, 215, 0, 0.5);
            font-size: 0.95vh;
            color: white;
            box-shadow: 0 0 1vh rgba(255, 215, 0, 0.3);
            max-height: 12vh;
            overflow-y: auto;
            flex-shrink: 0; /* Don't shrink */
        }
        
        #planetStatsLeftContent {
            font-size: 0.95vh;
            line-height: 1.15;
        }
        
        .rules-title {
            font-size: 2.2vh;
            font-weight: bold;
            margin-bottom: 1.5vh;
            text-align: center;
        }
        .rules-section {
            margin-bottom: 10px;
            font-size: clamp(10.56px, 1.37vh, 14.78px);
            line-height: 1.4;
        }
        .rules-section h3 {
            font-size: clamp(12.67px, 1.58vh, 16.9px);
            margin-bottom: 6px;
            color: #FFA07A;
        }
        .rules-section ul {
            margin: 4px 0;
            padding-left: 15px;
        }
        .rules-section li {
            margin-bottom: 3px;
        }
        .tsunami-scoring {
            display: inline-block;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }
        .score-display {
            font-size: 2.8vh;
            margin-bottom: 0.75vh;
        }
        .score-display > div:not(.score-label) {
            text-align: center;
        }
        .score-label {
            font-size: 1.6vh;
            opacity: 0.8;
            text-align: left;
        }
        
        /* Special Events Grid - 2 columns */
        .special-events-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            column-gap: 1vw;
            row-gap: 1vh;
            margin-top: 2.05vh; /* Reduced from 2.55vh to compensate for canvas increase */
        }
        .special-events-grid .score-display {
            margin-bottom: 0;
        }
        
        .next-piece {
            margin-top: 0.35vh;
            margin-bottom: 0.3vh;
            flex-shrink: 0;
        }
        .next-piece .score-label {
            text-align: left;
        }
        .next-canvas {
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.1);
            margin-top: 3vh; /* Increased from 2.5vh to add more space below "Next Piece" label */
            margin-bottom: 0.5vh;
            display: block;
            margin-left: auto;
            margin-right: auto;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            width: 180px;
            height: 180px;
            /* Crisp pixel rendering to prevent lines in fullscreen */
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        .controls {
            margin-top: auto;
            font-size: 1.35vh;
            line-height: 1.5;
            flex-grow: 0;
            flex-shrink: 0;
            overflow-y: auto;
            transition: opacity 0.3s ease-in-out;
        }
        .controls > div:not(.controls-title) {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1ch;
        }
        .controls .control-key {
            text-align: right;
        }
        .controls > div:not(.controls-title) > span:last-child {
            text-align: left;
        }
        .controls-title {
            margin-bottom: 0.5vh;
            text-align: left;
        }
        button {
            margin-top: 20px;
            padding: 10px 30px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px 50px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            display: none;
            min-width: 250px;
            z-index: 1000;
        }
        .start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        .start-message {
            text-align: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            position: relative;
            height: 120px;
            min-height: 120px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }
        .letter {
            display: inline-block;
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
        }
        .letter.animating {
            animation: letterFloat 2s ease-in-out;
        }
        @keyframes letterFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(var(--tx1), var(--ty1)) rotate(var(--r1)); }
            50% { transform: translate(var(--tx2), var(--ty2)) rotate(var(--r2)); }
            75% { transform: translate(var(--tx3), var(--ty3)) rotate(var(--r3)); }
        }
        
        /* Intro screen controls */
        .intro-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        .intro-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(30, 60, 120, 0.8);
            padding: 12px 24px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            min-width: 220px;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.2s;
        }
        .intro-toggle:hover {
            background: rgba(50, 80, 140, 0.9);
            border-color: rgba(255, 215, 0, 0.5);
        }
        .intro-toggle-label {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }
        .intro-toggle .toggle-switch {
            flex-shrink: 0;
        }
        .start-game-btn {
            margin-top: 20px;
            padding: 18px 50px;
            font-size: 22px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .start-game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
        }
        .start-game-btn:active {
            transform: scale(0.98);
        }
        .login-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            background: rgba(30, 60, 120, 0.9);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
            pointer-events: auto;
        }
        .login-btn:hover {
            background: rgba(50, 80, 140, 1);
            border-color: #FFD700;
        }
        .login-btn.hidden {
            display: none;
        }
        
        /* Login Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        .auth-modal {
            background: rgba(30, 60, 120, 0.95);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            min-width: 320px;
            max-width: 400px;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
        }
        .auth-modal h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: #FFD700;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            opacity: 0.7;
        }
        .modal-close:hover {
            opacity: 1;
        }
        .auth-modal .form-group {
            margin-bottom: 15px;
        }
        .auth-modal label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 1px;
        }
        .auth-modal input[type="text"],
        .auth-modal input[type="email"],
        .auth-modal input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }
        .auth-modal input:focus {
            outline: none;
            border-color: #FFD700;
        }
        .auth-submit-btn {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            letter-spacing: 2px;
        }
        .auth-submit-btn:hover {
            transform: scale(1.02);
        }
        .auth-divider {
            text-align: center;
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }
        .oauth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            background: white;
            color: #333;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            cursor: pointer;
        }
        .oauth-btn:hover {
            background: #f0f0f0;
        }
        .auth-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        .auth-footer a {
            color: #FFD700;
            text-decoration: none;
            margin-left: 5px;
        }
        .auth-footer a:hover {
            text-decoration: underline;
        }
        .error-message {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid rgba(255, 100, 100, 0.5);
            color: #ff6b6b;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }
        
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 2vh 2vw;
            box-sizing: border-box;
        }
        .settings-popup {
            background: rgba(30, 60, 120, 0.95);
            padding: 2vh 2vw;
            border-radius: 1.5vh;
            border: 0.3vh solid #fff;
            color: white;
            min-width: 30vw;
            max-width: 90vw;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 0 3vh rgba(0, 0, 0, 0.8);
            font-size: 1.6vh;
        }
        .settings-title {
            font-size: 2.8vh;
            font-weight: bold;
            margin-bottom: 2vh;
            text-align: center;
            text-shadow: 0.2vh 0.2vh 0.4vh rgba(0, 0, 0, 0.5);
        }
        .settings-option {
            margin-bottom: 1.8vh;
            padding: 1.5vh 1.5vw;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.8vh;
        }
        .settings-option label {
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 1.8vh;
        }
        .settings-option input[type="checkbox"] {
            width: 2vh;
            height: 2vh;
            margin-right: 1.2vw;
            cursor: pointer;
            display: none; /* Hide default checkbox */
        }
        
        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 5.5vh;
            height: 2.8vh;
            margin-right: 1.2vw;
            flex-shrink: 0;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            border-radius: 3vh;
            border: 0.2vh solid rgba(255, 255, 255, 0.3);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 2vh;
            width: 2vh;
            left: 0.3vh;
            bottom: 0.2vh;
            background-color: white;
            transition: all 0.3s ease;
            border-radius: 50%;
            box-shadow: 0 0.2vh 0.5vh rgba(0, 0, 0, 0.3);
        }
        
        input:checked + .toggle-slider {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(2.6vh);
        }
        
        .toggle-slider:hover {
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        input:checked + .toggle-slider:hover {
            border-color: #5cbf60;
        }
        
        /* Label adjustment for toggle switches */
        .settings-option label.toggle-label {
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 1.8vh;
            justify-content: space-between;
        }
        
        .toggle-label-text {
            flex-grow: 1;
        }
        .settings-option input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 0.8vh;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0.5vh;
            outline: none;
        }
        .settings-option input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 2vh;
            height: 2vh;
            background: #4CAF50;
            border-radius: 50%;
            cursor: pointer;
            border: 0.2vh solid white;
        }
        .settings-option input[type="range"]::-moz-range-thumb {
            width: 2vh;
            height: 2vh;
            background: #4CAF50;
            border-radius: 50%;
            cursor: pointer;
            border: 0.2vh solid white;
        }
        .settings-close-btn {
            width: 100%;
            margin-top: 1.3vh;
            padding: 1.2vh 3vw;
            font-size: 1.8vh;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 0.8vh;
            cursor: pointer;
            transition: background 0.3s;
        }
        .settings-close-btn:hover {
            background: #45a049;
        }
        
        /* Challenge dropdown styles */
        .settings-option select {
            width: 100%;
            padding: 0.8vh 0.8vw;
            font-size: 1.6vh;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 0.2vh solid rgba(255, 255, 255, 0.3);
            border-radius: 0.5vh;
            cursor: pointer;
            margin-top: 0.8vh;
        }
        .settings-option select option {
            background: #1e3c78;
            color: white;
        }
        
        /* Responsive adjustments for small screens */
        @media (max-height: 600px), (max-width: 600px) {
            .settings-popup {
                padding: 1.5vh 2vw;
                font-size: 1.4vh;
                min-width: 50vw;
            }
            .settings-title {
                font-size: 2.2vh;
                margin-bottom: 1.5vh;
            }
            .settings-option {
                margin-bottom: 1.2vh;
                padding: 1vh 1.2vw;
            }
            .settings-option label {
                font-size: 1.5vh;
            }
            .settings-close-btn {
                padding: 1vh 2vw;
                font-size: 1.5vh;
            }
        }
        
        /* Ensure scrollbar is styled on the settings popup */
        .settings-popup::-webkit-scrollbar {
            width: 0.8vw;
        }
        .settings-popup::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.4vw;
        }
        .settings-popup::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0.4vw;
        }
        .settings-popup::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* Combo challenge modal */
        .combo-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .combo-modal {
            background: rgba(30, 60, 120, 0.95);
            padding: 2vh 3vw;
            border-radius: 1.5vh;
            border: 0.3vh solid #FFD700;
            color: white;
            min-width: 40vw; /* Back to original width */
            max-width: 90vw;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 0 4vh rgba(255, 215, 0, 0.5);
        }
        .combo-modal-title {
            font-size: 1.8vh;
            font-weight: bold;
            margin-bottom: 1.2vh;
            text-align: center;
            color: #FFD700;
        }
        .combo-bonus-display {
            text-align: center;
            font-size: 1.5vh;
            font-weight: bold;
            color: #4CAF50;
            background: rgba(0, 0, 0, 0.4);
            padding: 0.8vh;
            border-radius: 0.8vh;
            margin-bottom: 1.2vh;
            border: 0.2vh solid rgba(76, 175, 80, 0.5);
        }
        .combo-bonus-display span {
            color: #FFD700;
            font-size: 1.7vh;
        }
        .combo-checkboxes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two equal columns */
            gap: 1vh 1.5vw; /* Reduced horizontal gap for narrower modal */
            margin-bottom: 1.5vh;
        }
        .combo-checkbox-option {
            margin: 0;
            padding: 0.8vh 1vw;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.8vh;
            border: 0.2vh solid transparent;
            transition: all 0.3s;
        }
        .combo-checkbox-option:hover {
            border-color: rgba(255, 215, 0, 0.5);
            background: rgba(0, 0, 0, 0.4);
        }
        .combo-checkbox-option label {
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 1.3vh;
        }
        .combo-checkbox-option input[type="checkbox"] {
            display: none; /* Hide default checkbox */
        }
        .combo-checkbox-option .toggle-switch {
            position: relative;
            display: inline-block;
            width: 2.4vh;  /* Reduced from 4.5vh - about half size */
            height: 1.2vh;  /* Reduced from 2.3vh - about half size */
            margin-right: 1vh;  /* Space between switch and label */
            flex-shrink: 0;
        }
        .combo-checkbox-option .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            border-radius: 1.5vh;
            border: 0.1vh solid rgba(255, 255, 255, 0.3);
        }
        .combo-checkbox-option .toggle-slider:before {
            position: absolute;
            content: "";
            height: 0.9vh;  /* Reduced from 1.7vh */
            width: 0.9vh;   /* Reduced from 1.7vh */
            left: 0.1vh;
            bottom: 0.05vh;
            background-color: white;
            transition: all 0.3s ease;
            border-radius: 50%;
            box-shadow: 0 0.05vh 0.2vh rgba(0, 0, 0, 0.3);
        }
        .combo-checkbox-option input:checked + .toggle-slider {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }
        .combo-checkbox-option input:checked + .toggle-slider:before {
            transform: translateX(1.1vh);  /* Reduced from 2.1vh */
        }
        .combo-checkbox-option .challenge-description {
            font-size: 1.2vh; /* Increased from 1.0vh */
            opacity: 0.85; /* Slightly more visible */
            margin-top: 0.3vh;
            margin-left: 3.4vh;  /* Updated to align with label (2.4vh switch + 1vh spacing) */
        }
        .combo-modal-buttons {
            display: flex;
            gap: 1vw;
            margin-top: 1.5vh;
            position: sticky;
            bottom: 0;
            background: rgba(30, 60, 120, 0.95);
            padding-top: 1vh;
        }
        .combo-modal-btn {
            flex: 1;
            padding: 1vh 2vw;
            font-size: 1.6vh;
            border: none;
            border-radius: 0.8vh;
            cursor: pointer;
            transition: all 0.3s;
        }
        .combo-modal-btn.apply {
            background: #4CAF50;
            color: white;
        }
        .combo-modal-btn.apply:hover {
            background: #45a049;
        }
        .combo-modal-btn.cancel {
            background: #f44336;
            color: white;
        }
        .combo-modal-btn.cancel:hover {
            background: #da190b;
        }
        
        /* Upside-down mode */
        html.stranger-mode {
            transform: rotate(180deg);
        }
        
        /* Thinner mode - make canvas narrower */
        canvas.thinner-mode {
            transform: scaleX(0.6);
        }
        
        /* Thicker mode - canvas dimensions handled by JavaScript updateCanvasSize() */
        canvas.thicker-mode {
            /* Dimensions set via style attribute in updateCanvasSize() */
            /* This creates actual layout space unlike transform */
            margin: auto; /* Center the canvas */
        }
        
        /* Allow main area to properly center the thicker canvas */
        body:has(canvas.thicker-mode) .main-area {
            overflow: visible; /* Allow scaled canvas to extend beyond */
            padding: 1vh 0.25vw; /* Reduce side padding */
            z-index: 10; /* Ensure it renders on top */
            justify-content: center; /* Center vertically */
        }
        
        /* Make both side panels symmetric when Thicker mode is active */
        body:has(canvas.thicker-mode) .game-container {
            gap: 2vw; /* Consistent gap with normal mode */
            justify-content: space-between; /* Maintain spacing */
            align-items: center; /* Center main area vertically */
        }
        
        /* Allow perspective transforms to render without clipping */
        body:has(canvas.longago-mode) .main-area,
        body:has(canvas.comingsoon-mode) .main-area {
            overflow: visible;
        }
        
        body:has(canvas.longago-mode) .game-container,
        body:has(canvas.comingsoon-mode) .game-container {
            overflow: visible;
        }
        
        body:has(canvas.longago-mode) .content-area,
        body:has(canvas.comingsoon-mode) .content-area {
            overflow: visible;
        }
        
        /* Removed thicker-mode panel width adjustments - panels now reposition via JavaScript */
        
        /* Make the instructions text smaller in thicker mode */
        body:has(canvas.thicker-mode) .rules-instructions {
            font-size: 1.3vh;
        }
        
        /* Adjust the controls/stats section */
        body:has(canvas.thicker-mode) .controls {
            font-size: 1.15vh; /* Smaller text */
        }
        
        /* Make stats displays more compact */
        body:has(canvas.thicker-mode) .stat-value {
            font-size: 1.6vh;
        }
        
        /* Adjust score displays in Thicker mode */
        body:has(canvas.thicker-mode) .score-display {
            font-size: 1.4vh;
        }
        
        body:has(canvas.thicker-mode) .score-display > div:not(.score-label) {
            font-size: 1.8vh; /* Smaller score values */
        }
        
        /* Histogram adjustments */
        body:has(canvas.thicker-mode) .histogram-canvas {
            min-height: 25vh; /* Smaller histogram */
        }
        
        /* Long Ago mode - Star Wars opening crawl perspective */
        canvas.longago-mode {
            transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%);
            transform-origin: center center;
            filter: brightness(0.9);
        }
        
        /* Coming Soon mode - Reverse perspective (top wide, bottom narrow) */
        canvas.comingsoon-mode {
            transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%);
            transform-origin: center center;
            filter: brightness(0.9);
        }
        
        /* Combined mode: Thinner + Long Ago */
        canvas.thinner-mode.longago-mode {
            transform: perspective(800px) rotateX(45deg) scaleX(0.6) scale(1.5) translateY(-25%);
            transform-origin: center center;
            filter: brightness(0.9);
        }
        
        /* Combined mode: Thinner + Coming Soon */
        canvas.thinner-mode.comingsoon-mode {
            transform: perspective(800px) rotateX(-45deg) scaleX(0.6) scale(1.5) translateY(25%);
            transform-origin: center center;
            filter: brightness(0.9);
        }
        
        /* Combined mode: Thicker + Long Ago */
        canvas.thicker-mode.longago-mode {
            transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%);
            transform-origin: center center;
            filter: brightness(0.9);
        }
        
        /* Combined mode: Thicker + Coming Soon */
        canvas.thicker-mode.comingsoon-mode {
            transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%);
            transform-origin: center center;
            filter: brightness(0.9);
        }
        
        /* Vine wrapper perspective transforms (same as canvas) */
        .vineWrapper.longago-mode {
            transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%);
            transform-origin: center center;
        }
        
        .vineWrapper.comingsoon-mode {
            transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%);
            transform-origin: center center;
        }
        
        .vineWrapper.thinner-mode.longago-mode {
            transform: perspective(800px) rotateX(45deg) scaleX(0.6) scale(1.5) translateY(-25%);
            transform-origin: center center;
        }
        
        .vineWrapper.thinner-mode.comingsoon-mode {
            transform: perspective(800px) rotateX(-45deg) scaleX(0.6) scale(1.5) translateY(25%);
            transform-origin: center center;
        }
        
        .vineWrapper.thicker-mode.longago-mode {
            transform: perspective(800px) rotateX(45deg) scale(1.5) translateY(-25%);
            transform-origin: center center;
        }
        
        .vineWrapper.thicker-mode.comingsoon-mode {
            transform: perspective(800px) rotateX(-45deg) scale(1.5) translateY(25%);
            transform-origin: center center;
        }
        
        .settings-btn {
            position: absolute;
            top: 1vh;
            right: 1.5vw;
            padding: 1vh 1.5vw;
            font-size: 1.8vh;
            background: rgba(30, 60, 120, 0.8);
            color: white;
            border: 0.2vh solid rgba(255, 255, 255, 0.5);
            border-radius: 0.8vh;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }
        .settings-btn:hover {
            background: rgba(30, 60, 120, 1);
            border-color: #fff;
        }
        
        /* Hide UI elements during gameplay */
        .hidden-during-play {
            display: none !important;
        }
        
        .mode-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: transparent;
            padding: 20px;
            box-sizing: border-box;
            pointer-events: none;
            z-index: 10; /* Ensure tooltips appear above left panel */
        }
        .mode-menu.hidden {
            display: none;
        }
        .mode-button {
            width: 90%;
            max-width: 250px;
            pointer-events: auto;
            margin: 8px 0;
            padding: 12px 20px;
            font-size: 18px;
            font-weight: bold;
            background: rgba(30, 60, 120, 0.9);
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        .mode-button:hover {
            background: rgba(50, 80, 140, 1);
            border-color: #fff;
            transform: scale(1.05);
        }
        .mode-button:active {
            transform: scale(0.98);
        }
        .mode-button.selected {
            background: rgba(50, 80, 140, 1);
            border-color: #FFD700;
            border-width: 3px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }
        .mode-button[data-tooltip] {
            position: relative;
        }
        .mode-button[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 110%;
            top: 50%;
            transform: translateY(-50%);
            background: #000000;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 9999;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            animation: tooltipFadeIn 0.2s ease-in;
        }
        .mode-button[data-tooltip]:hover::before {
            content: '';
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 8px solid transparent;
            border-right-color: #000000;
            z-index: 9998;
            pointer-events: none;
        }
        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: translateY(-50%) translateX(10px);
            }
            to {
                opacity: 1;
                transform: translateY(-50%) translateX(0);
            }
        }
        .game-credits {
            margin-top: 20px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            line-height: 1.6;
        }
        .game-credits a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
        }
        .game-credits a:hover {
            color: #fff;
        }
        .challenge-selector {
            margin-bottom: 25px;
            text-align: center;
            pointer-events: auto;
            width: 90%;
            max-width: 290px;
        }
        .challenge-selector label {
            display: block;
            margin-bottom: 8px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .challenge-select-btn {
            width: 100%;
            padding: 10px 15px;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            box-sizing: border-box;
            transition: all 0.2s ease;
        }
        .challenge-select-btn:hover {
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(0, 0, 0, 0.7);
        }
        .challenge-select-btn:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.7);
        }
        .challenge-select-btn::after {
            content: ' ▼';
            font-size: 10px;
            opacity: 0.7;
        }
        /* Leaderboard Styles */
        .leaderboard-container {
            padding: 20px;
            color: white;
            overflow-y: auto;
            max-height: 100%;
        }
        
        #leaderboardContent {
            color: white;
            overflow-y: auto;
            overflow-x: visible;
            height: 100%;
            pointer-events: auto;
            position: relative;
            z-index: 10;
        }
        
        .leaderboard-title {
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
            color: #FFD700;
        }
        
        .leaderboard-mode-selector {
            text-align: center;
            margin-bottom: 15px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .leaderboard-mode-selector .current-mode {
            color: #FFD700;
            font-weight: bold;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            overflow: visible;
            position: relative;
        }
        
        .leaderboard-table th {
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 4px;
            text-align: left;
            border-bottom: 1px solid #FFD700;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        
        .leaderboard-table td {
            padding: 5px 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .leaderboard-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .leaderboard-table tr.player-score {
            background: rgba(255, 215, 0, 0.2);
            font-weight: bold;
            color: #FFD700;
        }
        
        .leaderboard-table .rank {
            width: 30px;
            text-align: center;
            font-weight: bold;
        }
        
        .leaderboard-table .name {
            width: 35%;
        }
        
        .leaderboard-table .score {
            width: 25%;
        }
        
        .special-events {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .leaderboard-table .challenges-col {
            width: 8%;
            text-align: center;
            cursor: help;
        }
        
        .challenge-count {
            display: inline-block;
            background: rgba(255, 165, 0, 0.3);
            color: #FFD700;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            pointer-events: auto;
        }
        
        .leaderboard-table tr.has-challenges {
            cursor: help;
        }
        
        .leaderboard-table tr.has-challenges td {
            cursor: help;
        }
        
        .leaderboard-table tr.has-challenges:hover {
            background: rgba(255, 165, 0, 0.15) !important;
        }
        
        .leaderboard-loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .leaderboard-error {
            text-align: center;
            padding: 40px;
            color: #ff6b6b;
        }
        
        /* Name Entry Modal */
        .name-entry-overlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: rgba(0, 0, 0, 0.9) !important;
            z-index: 99999 !important; /* Maximum to ensure it's always on top */
            display: none;
            justify-content: center !important;
            align-items: center !important;
            pointer-events: all !important; /* Ensure it captures clicks */
        }
        
        .name-entry-popup {
            background: linear-gradient(135deg, rgba(30, 60, 120, 0.95), rgba(20, 40, 80, 0.95));
            padding: 40px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 215, 0, 0.3);
            min-width: 400px;
            max-width: 500px;
            position: relative;
            z-index: 100000;
            display: block !important; /* Always visible when parent is flex */
            pointer-events: auto;
        }
        
        .name-entry-title {
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .name-entry-message {
            font-size: 18px;
            color: white;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .name-entry-score {
            font-size: 24px;
            color: #FFD700;
            font-weight: bold;
        }
        
        .name-entry-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #FFD700;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            text-align: center;
            margin-bottom: 20px;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: text;
            user-select: text;
        }
        
        .name-entry-input:focus {
            outline: none;
            border-color: #FFA500;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .name-entry-button {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        
        .name-entry-button:hover {
            background: #45a049;
        }
        
        .name-entry-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
    </style>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17791773957">
	</script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	
	  gtag('config', 'AW-17791773957');
	</script>
</head>
<body>
    <script>
        // Domain-based title switching - runs immediately
        (function() {
            const hostname = window.location.hostname.toLowerCase();
            const isTantris = hostname.includes('tantris') || hostname.includes('itch.io') || hostname.includes('itch.zone');
            
            // Update document title
            document.title = isTantris ? 'TaNTЯiS' : 'BLOCKCHaiNSTOЯM';
            
            // Expose for other scripts
            window.GAME_TITLE = isTantris ? 'TaNTЯiS' : 'BLOCKCHaiNSTOЯM';
            window.IS_TANTRIS = isTantris;
            
            // Inject CSS to permanently hide the inactive title
            const style = document.createElement('style');
            if (isTantris) {
                style.textContent = '#title-blockchainstorm { display: none !important; }';
            } else {
                style.textContent = '#title-tantris { display: none !important; }';
            }
            document.head.appendChild(style);
            
            // Remove inline style from tantris title when on tantris domain (so JS can control it)
            if (isTantris) {
                document.addEventListener('DOMContentLoaded', function() {
                    const tantrisTitle = document.getElementById('title-tantris');
                    if (tantrisTitle) tantrisTitle.style.display = '';
                });
            }
        })();
    </script>
    <div class="start-overlay" id="startOverlay">
        <!-- button class="login-btn" id="introLoginBtn">🔑 Login</button -->
        <div class="start-message" id="dontPanicText">Don't Panic!</div>
        <div class="intro-controls" id="introControls">
            <label class="intro-toggle" id="introFullscreenToggle">
                <span class="intro-toggle-label">Full Screen</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="introFullscreenCheckbox" checked>
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <label class="intro-toggle">
                <span class="intro-toggle-label">Music</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="introMusicCheckbox" checked>
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <label class="intro-toggle">
                <span class="intro-toggle-label">Sound Effects</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="introSoundCheckbox" checked>
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <button class="start-game-btn" id="startGameBtn">▶ Start Game</button>
        </div>
    </div>
    <canvas id="starfield"></canvas>
    <button class="settings-btn" id="settingsBtn">⚙️ Settings</button>
    <div class="header">
        <div class="title" id="title-blockchainstorm">
            ₿L<span style="position: relative; display: inline-block;">
                <span style="position: relative; z-index: 1; -webkit-text-fill-color: #FFA500; color: #FFA500; background: none;">O</span>
                <svg style="position: absolute; left: 62%; top: 50%; transform: translate(-50%, -50%) rotate(10deg) scaleX(1.2); width: 150%; height: 150%; pointer-events: none; z-index: 2;" viewBox="0 0 10 10">
                    <defs>
                        <filter id="lightning-glow">
                            <feGaussianBlur stdDeviation="0.125" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <!-- Gold lightning bolt with dark outline -->
                    <path d="M 5.5535055,0.41389914 2,5 4.0571956,4.9630996 1.5,9.5 5.9797048,4.3769988 3.6476015,4.3154982 Z" 
                          fill="#FFD700"
                          stroke="#000000"
                          stroke-width="0.15"
                          stroke-opacity="0.6"
                          filter="url(#lightning-glow)"/>
                </svg>
            </span>CK<span style="-webkit-text-fill-color: #B87700; color: #B87700; background: none;">CH</span><span style="-webkit-text-fill-color: #FFE87C; color: #FFE87C; background: none; filter: drop-shadow(0 0 0.3vh rgba(255, 232, 124, 0.8));">ai</span><span style="-webkit-text-fill-color: #B87700; color: #B87700; background: none;">N</span>ST<span style="position: relative; display: inline-block;">
                <span style="position: relative; z-index: 1; -webkit-text-fill-color: #FFA500; color: #FFA500; background: none;">O</span>
                <svg style="position: absolute; left: 62%; top: 50%; transform: translate(-50%, -50%) rotate(10deg) scaleX(1.2); width: 150%; height: 150%; pointer-events: none; z-index: 2;" viewBox="0 0 10 10">
                    <defs>
                        <filter id="lightning-glow2">
                            <feGaussianBlur stdDeviation="0.125" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <!-- Gold lightning bolt with dark outline -->
                    <path d="M 5.5535055,0.41389914 2,5 4.0571956,4.9630996 1.5,9.5 5.9797048,4.3769988 3.6476015,4.3154982 Z" 
                          fill="#FFD700"
                          stroke="#000000"
                          stroke-width="0.15"
                          stroke-opacity="0.6"
                          filter="url(#lightning-glow2)"/>
                </svg>
            </span>ЯM
        </div>
        <div class="title" id="title-tantris" style="display: none;">
            T<span style="-webkit-text-fill-color: #FFE87C; color: #FFE87C; background: none; filter: drop-shadow(0 0 0.3vh rgba(255, 232, 124, 0.8));">a</span>NT<span style="-webkit-text-fill-color: #FFA500; color: #FFA500; background: none;">Я</span><span style="-webkit-text-fill-color: #FFE87C; color: #FFE87C; background: none; filter: drop-shadow(0 0 0.3vh rgba(255, 232, 124, 0.8));">i</span>S
        </div>
    </div>

    <div class="content-area">
        <div class="game-container">
        <div class="rules-panel">
            <div class="rules-instructions">
                <div class="rules-title">How to Play</div>
                
                <div class="rules-section">
                    <h3>🎮 Goal</h3>
                    Stack colored blocks to form "blobs" (connected groups of blocks of a single color). Clear rows to break up blobs and score points!
                </div>
                
                <div class="rules-section">
                    <h3>✨ Special Events</h3>
                    <strong>⚡ Strike:</strong> Clear 4 rows at once for 2× points and a lightning strike!
                    <br><br>
                    <strong>🌊 Tsunami:</strong> Create a blob that spans the full width of the well and the ENTIRE blob clears for massive points!
                    <br><br>
                    <strong>🌋 Volcano:</strong> When a blob touching any edge is surrounded by another blob and the edge, it turns to lava, erupting upward and raining down as single blocks. Each lava segment cleared multiplies the line clear by 2<sup>n</sup> (1 segment = 2×, 2 segments = 4×, 3 segments = 8×)!
                    <br><br>
                    <strong>🕳️ Black Hole:</strong> When one blob completely envelops another, the inner blob becomes a black hole that sucks in ALL blocks from both blobs! Purple border, huge points!
                </div>
                
                <div class="rules-section">
                    <h3>📊 Scoring</h3>
                    <strong>Level:</strong> Increases as you clear lines (every 11 lines = +1 level). Higher levels mean faster piece drops and higher score multipliers!
                    <br><br>
                    <strong>Normal:</strong> (Blob Size)² × Blocks Cleared × 100 × Level
                    <ul>
                        <li>Strike bonus: 2× all points</li>
                        <li>Bigger blobs = exponentially more points!</li>
                    </ul>
                    <strong class="tsunami-scoring">Tsunami:</strong> (Size)³ × 200 × Level
                    <br>
                    <strong>Volcano:</strong>
                    <ul>
                        <li>Inner (lava): (Size)³ × 500 × Level</li>
                        <li>Lava in lines: 2<sup>n</sup> multiplier (n = # of lava segments)</li>
                    </ul>
                    <strong>Black Hole:</strong>
                    <ul>
                        <li>Inner (core): (Size)³ × 800 × Level</li>
                        <li>Outer (sucked in): (Size)³ × 800 × Level</li>
                    </ul>
                </div>
            </div>
            
            <!-- Histogram Canvas -->
            <canvas id="histogramCanvas" class="histogram-canvas"></canvas>
            
            <!-- Planet Stats in Left Panel (Tablet Mode) -->
            <div id="planetStatsLeft">
                <div id="planetStatsLeftContent"></div>
            </div>
        </div>
        
        <div class="main-area">
            <canvas id="gameCanvas" width="350" height="700"></canvas>
            <div class="mode-menu" id="modeMenu">
                
                <div class="challenge-selector">
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); white-space: nowrap;">
                        Select Challenge Mode(s)...
                    </div>
                    <button id="challengeSelectBtn" class="challenge-select-btn">Normal</button>
                </div>
				
                <div style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                    Choose your difficulty level...
                </div>
                <button class="mode-button" data-mode="drizzle" data-tooltip="Easy mode - 4 colors, standard 10-wide board">🌧️ Drizzle</button>
                <button class="mode-button" data-mode="downpour" data-tooltip="Standard mode - 6 colors, 10-wide board">⛈️ Downpour</button>
                <button class="mode-button" data-mode="hailstorm" data-tooltip="8 colors for maximum challenge">🧊 Hailstorm</button>
                <button class="mode-button" data-mode="blizzard" data-tooltip="12-wide board with 5-block pieces, 5 colors">❄️ Blizzard</button>
                <button class="mode-button" data-mode="hurricane" data-tooltip="Ultimate challenge - 12-wide + 5-block pieces, 7 colors">🌀 Hurricane</button>
                
                <div class="game-credits">
                    <div><strong>Game Design:</strong> C. Ryan Deardorff</div>
                    <div><strong>Programming:</strong> Claude AI (Anthropic)</div>
                </div>
            </div>
            <div class="game-over" id="gameOver">
                <div style="font-size: 32px; margin-bottom: 20px;">GAME OVER</div>
                <div id="finalScore"></div>
                <div id="finalStats" style="margin-top: 20px; font-size: 16px; color: rgba(255,255,255,0.8); white-space: nowrap;"></div>
                <button id="playAgainBtn">Play Again</button>
            </div>
        </div>
        <div class="side-panel">
            <div class="score-display">
                <div class="score-label">Score</div>
                <div id="score">0</div>
            </div>
            <div class="score-display">
                <div class="score-label">Lines</div>
                <div id="lines">0</div>
            </div>
            <div class="score-display">
                <div class="score-label">Level</div>
                <div id="level">1</div>
            </div>
            <div class="next-piece" id="nextPieceSection">
                <div class="score-label">Next Piece</div>
                <canvas id="nextCanvas" class="next-canvas" style="width: min(100%, 18vh); height: min(100%, 18vh); aspect-ratio: 1; display: block;"></canvas>
            </div>
            
            <!-- Special Events Grid (2 columns) -->
            <div class="special-events-grid">
                <div class="score-display">
                    <div class="score-label">⚡ Strikes</div>
                    <div id="strikes">0</div>
                </div>
                <div class="score-display">
                    <div class="score-label">🕳️ Black Holes</div>
                    <div id="blackholes">0</div>
                </div>
                <div class="score-display">
                    <div class="score-label">🌊 Tsunamis</div>
                    <div id="tsunamis">0</div>
                </div>
                <div class="score-display">
                    <div class="score-label">🌋 Volcanoes</div>
                    <div id="volcanoes">0</div>
                </div>
            </div>
            
            <!-- Controls and Planet Stats occupy the same space -->
            <div class="controls">
                <div><span class="control-key">← → :</span><span>Move</span></div>
                <div><span class="control-key">↓ :</span><span>Soft Drop</span></div>
                <div><span class="control-key">↑ :</span><span>Rotate CW</span></div>
                <div><span class="control-key">Space :</span><span>Hard Drop</span></div>
                <div><span class="control-key">P :</span><span>Pause</span></div>
                <div><span class="control-key">PgUp/PgDn :</span><span>Toggle Fullscreen</span></div>
                <div style="margin-top: 10px;"><span class="control-key">Numpad 4/6 :</span><span>Move</span></div>
                <div><span class="control-key">Numpad 2 :</span><span>Soft Drop</span></div>
                <div><span class="control-key">Numpad 5 :</span><span>Rotate CCW</span></div>
                <div><span class="control-key">Numpad 0 :</span><span>Hard Drop</span></div>
            </div>
            
            <!-- Planet Stats Display - Appears in same location as controls during gameplay -->
            <div id="planetStats" style="display: none; margin-top: 2.4vh; padding: 1vh 0.9vw; background: rgba(20, 40, 80, 0.9); border-radius: 0.8vh; border: 0.2vh solid rgba(255, 215, 0, 0.5); font-size: 1.25vh; color: white; box-shadow: 0 0 1vh rgba(255, 215, 0, 0.3);">
                <div id="planetStatsContent"></div>
            </div>
            
            <!-- Touch Controls for Tablet Mode -->
            <div id="touchControls">
                <button class="touch-btn touch-btn-rotate-ccw" id="touchRotateCCW">↺</button>
                <button class="touch-btn touch-btn-left" id="touchLeft">⬅</button>
                <button class="touch-btn touch-btn-rotate" id="touchRotate">↻</button>
                <button class="touch-btn touch-btn-right" id="touchRight">➡</button>
                <button class="touch-btn touch-btn-down" id="touchDown">⬇</button>
                <button class="touch-btn touch-btn-drop" id="touchDrop">⬇⬇</button>
            </div>
        </div>
    </div>
    </div>
    
    <!-- Pause Button (shown in top-right during tablet mode gameplay) -->
    <button class="pause-btn" id="pauseBtn">⏸️</button>
    
    <!-- Settings Popup -->
    <div class="settings-overlay" id="settingsOverlay">
        <div class="settings-popup">
            <div class="settings-title">⚙️ Settings</div>
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text">Music</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="musicToggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </label>
            </div>
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text">Sound Effects</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="soundToggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </label>
            </div>
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text">Background Storm Effects</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="stormEffectsToggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </label>
            </div>
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text">Reverse Camera (sun behind)</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="cameraOrientationToggle">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
            </div>
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text">Training Wheels (shows shadow, -50% points)</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="trainingWheelsToggle">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
                <div style="font-size: 1.2vh; opacity: 0.8; margin-top: 0.5vh; margin-left: 1vh;">
                    Shows a shadow where pieces will land, but all points earned are cut in half.
                </div>
            </div>
            
            <div class="settings-option">
                <label style="display: block; margin-bottom: 1vh;">
                    Piece Opacity
                </label>
                <input type="range" id="opacitySlider" min="0" max="100" step="1" value="42" 
                       style="width: 100%; cursor: pointer;">
                <div style="display: flex; justify-content: space-between; font-size: 1.4vh; margin-top: 0.5vh; opacity: 0.8;">
                    <span>Transparent</span>
                    <span>Opaque</span>
                </div>
            </div>
            
            <div class="settings-option">
                <label style="display: block; margin-bottom: 1vh;">
                    Starfield Speed
                </label>
                <input type="range" id="starSpeedSlider" min="0" max="4" step="0.5" value="1" 
                       style="width: 100%; cursor: pointer;">
                <div style="display: flex; justify-content: space-between; font-size: 1.4vh; margin-top: 0.5vh; opacity: 0.8;">
                    <span>Off/Slow</span>
                    <span>Fast</span>
                </div>
            </div>
            
            <div class="settings-option" id="minimalistOption">
                <label class="toggle-label">
                    <span class="toggle-label-text">Minimalist Mode</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="minimalistToggle">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
                <div style="font-size: 1.2vh; opacity: 0.8; margin-top: 0.5vh; margin-left: 1vh;">
                    Hides UI, transparent well, alternate Sun
                </div>
            </div>
            
            <button class="settings-close-btn" id="settingsCloseBtn">Close</button>
        </div>
    </div>

    <!-- Combo Challenge Modal -->
    <div class="combo-modal-overlay" id="comboModalOverlay">
        <div class="combo-modal">
            <div class="combo-modal-title">🎯 Select Challenge Combination</div>
            <div class="combo-bonus-display" id="comboBonusDisplay">
                Score Bonus: <span id="comboBonusPercent">0%</span>
            </div>
            
            <div class="combo-checkboxes-grid">
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboStranger" value="stranger">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Stranger (Upside Down) +7%</span>
                </label>
                <div class="challenge-description">Entire screen rotates 180°, pieces fall upward</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboDyslexic" value="dyslexic">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Dyslexic (Reversed Controls) +6%</span>
                </label>
                <div class="challenge-description">Left and right controls are swapped</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboPhantom" value="phantom">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Phantom (Invisible Stack) +7%</span>
                </label>
                <div class="challenge-description">Stack fades out after each piece lands</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboRubber" value="rubber">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Rubber & Glue (Bouncing) +5%</span>
                </label>
                <div class="challenge-description">Pieces bounce if they don't touch same-colored blobs</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboOz" value="oz">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Oz (Grayscale Until Landing) +5%</span>
                </label>
                <div class="challenge-description">Falling pieces are grayscale, reveal color on landing</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboThinner" value="thinner">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Thinner (Skinny Well) +4%</span>
                </label>
                <div class="challenge-description">Blocks are half as wide, making a narrow well</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboThicker" value="thicker">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Thicker (Wide Well) +3%</span>
                </label>
                <div class="challenge-description">Well is 2/3 height and 20% wider, creating a wide playing field</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboCarrie" value="carrie">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Carrie (Blood Rain) +3%</span>
                </label>
                <div class="challenge-description">Blood rains down and runs down the stack</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboNokings" value="nokings">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>No Kings (Poo Rain) +3%</span>
                </label>
                <div class="challenge-description">Poo rains down and runs down the stack</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboLongAgo" value="longago">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Long Ago... (Star Wars Perspective) +4%</span>
                </label>
                <div class="challenge-description">Well tilts back in 3D perspective like Star Wars opening</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboComingSoon" value="comingsoon">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Coming Soon... (Inverse Star Wars Perspective) +4%</span>
                </label>
                <div class="challenge-description">Well tilts forward - pieces drop into distance</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboNervous" value="nervous">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Nervous (Vibrating Well) +2%</span>
                </label>
                <div class="challenge-description">The entire well vibrates up and down constantly</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboSixSeven" value="sixseven">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Six Seven (???) +4%</span>
                </label>
                <div class="challenge-description">???</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboGremlins" value="gremlins">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Gremlins (Chaos Blocks) +6%</span>
                </label>
                <div class="challenge-description">Blocks randomly appear or disappear from the stack</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboLattice" value="lattice">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Lattice (Pre-filled Blocks) +5%</span>
                </label>
                <div class="challenge-description">Start with random blocks in bottom half of well</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboYesAnd" value="yesand">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Yes, And... (Base Reality+) +5%</span>
                </label>
                <div class="challenge-description">Pieces spawn random extra blocks when they land</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboMercurial" value="mercurial">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Mercurial (Color-Shifting Pieces) +4%</span>
                </label>
                <div class="challenge-description">Falling pieces randomly change color every 2-4 seconds</div>
            </div>
            </div> <!-- End of combo-checkboxes-grid -->
            
            <div class="combo-buttons">            
				<div class="combo-modal-buttons">
					<button class="combo-modal-btn cancel" id="comboCancelBtn">Cancel</button>
					<button class="combo-modal-btn apply" id="comboApplyBtn">Apply</button>
				</div>
			</div>
		</div>
    </div>
	
    <!-- Name Entry Modal (moved outside game-container for proper layout) -->
    <div class="name-entry-overlay" id="nameEntryOverlay">
        <div class="name-entry-popup">
            <div class="name-entry-title">🏆 High Score! 🏆</div>
            <div class="name-entry-message">
                Congratulations! Your score of <span class="name-entry-score" id="nameEntryScore"></span> 
                made it to the top 20!
                <br><br>
                Enter your name for the leaderboard:
            </div>
            <input type="text" 
                   id="nameEntryInput" 
                   class="name-entry-input" 
                   placeholder="Enter your name" 
                   maxlength="20"
                   autocomplete="off"
                   inputmode="text"
                   enterkeyhint="done"
                   autocapitalize="words"
                   autocorrect="off">
            <button id="nameEntrySubmit" class="name-entry-button">Submit Score</button>
        </div>
    </div>
    
    <!-- Login Modal (from auth.js) -->
    <div class="modal-overlay" id="loginModal">
        <div class="auth-modal">
            <button class="modal-close" onclick="hideLoginModal()">&times;</button>
            
            <h2 id="modalTitle">LOGIN</h2>
            
            <div class="error-message" id="loginError"></div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group" id="usernameGroup" style="display: none;">
                    <label>USERNAME</label>
                    <input type="text" id="username" name="username" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label>EMAIL</label>
                    <input type="email" id="email" name="email" required autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label>PASSWORD</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                
                <div style="text-align: right; margin-bottom: 15px;">
                    <a href="https://official-intelligence.art/reset-password" style="font-size: 12px; color: rgba(255,255,255,0.6);">Forgot password?</a>
                </div>
                
                <button type="submit" class="auth-submit-btn" id="submitBtn">ENTER</button>
            </form>
            
            <div class="auth-divider">OR</div>
            
            <div class="oauth-buttons">
                <a href="https://official-intelligence-api.onrender.com/auth/google/login" class="oauth-btn">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Continue with Google
                </a>
            </div>
            
            <div class="auth-footer">
                <span id="authToggleText">No account?</span>
                <a href="#" id="authToggle" onclick="toggleAuthMode(event)">Sign up</a>
            </div>
        </div>
    </div>
	
	<script src="auth.js"></script>
	<script src="leaderboard.js"></script>
	<script src="storm-effects.js"></script>
	<script src="render-utils.js"></script>
	<script src="audio.js"></script>
	<script src="starfield.js"></script>
	<script src="game.js"></script>
	<script src="settings-sync.js"></script>

</body>
</html>
