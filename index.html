<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>TaNT–ØiS</title>

	
	<meta name="description" content="Play TaNT–ØiS, a revolutionary twist on classic Tetris. Journey through the solar system, survive cosmic disasters, and compete on global leaderboards. Free browser game.">
	<meta name="keywords" content="Tetris, block puzzle game, falling blocks, free online game, browser game, puzzle game, AI game, space game">
	<meta name="robots" content="index, follow">
	<link rel="canonical" href="https://blockchainstorm.official-intelligence.art/">

	<!-- Open Graph -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://tantris.official-intelligence.art/">
	<meta property="og:title" content="TaNT–ØiS - Free Online Falling Blocks Game">
	<meta property="og:description" content="A revolutionary twist on classic Tetris. Journey through the solar system, survive cosmic disasters, and compete on global leaderboards.">
	<meta property="og:image" content="https://res.cloudinary.com/dzlhmwvlx/image/upload/v1764977477/BLOCKCHaiNSTO%D0%AFM_thumb_pceyvy.png">

	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="TaNT–ØiS - Free Online Falling Blocks Game">
	<meta name="twitter:description" content="A revolutionary twist on classic Tetris. Journey through the solar system and compete on global leaderboards.">
	<meta name="twitter:image" content="https://res.cloudinary.com/dzlhmwvlx/image/upload/v1764977477/BLOCKCHaiNSTO%D0%AFM_thumb_pceyvy.png">
    
    <!-- iOS Standalone Mode (Add to Home Screen) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaNT–ØiS">
    
    <!-- Android/Chrome PWA -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17791773957">
	</script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'AW-17791773957');
	</script>
	
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Portrait orientation overlay for mobile -->
    <div id="portraitOverlay">
        <div class="portrait-overlay-content">
            <div class="rotate-icon">üì±</div>
            <div class="rotate-text" data-i18n="rotate.message">Rotate your device to landscape mode</div>
            <div class="rotate-subtext">for the best experience</div>
        </div>
    </div>
    <script>
        // Game title ‚Äî always TaNT–ØiS
        document.title = 'TaNT–ØiS';
        window.GAME_TITLE = 'TaNT–ØiS';

        // Show tantris titles (they have inline display:none for flash prevention)
        document.addEventListener('DOMContentLoaded', function() {
            var t = document.getElementById('title-tantris');
            if (t) t.style.display = '';
            var ti = document.getElementById('title-tantris-intro');
            if (ti) ti.style.display = '';
        });
    </script>
    <div class="start-overlay" id="startOverlay">
        <!-- button class="login-btn" id="introLoginBtn">üîë Login</button -->
        <div class="intro-title well-title" id="title-tantris-intro" style="display: none;">
                    T<span style="-webkit-text-fill-color: #FFE87C; color: #FFE87C; background: none; filter: drop-shadow(0 0 0.3vh rgba(255, 232, 124, 0.8));">a</span>NT<span style="-webkit-text-fill-color: #FFA500; color: #FFA500; background: none;">–Ø</span><span style="-webkit-text-fill-color: #FFE87C; color: #FFE87C; background: none; filter: drop-shadow(0 0 0.3vh rgba(255, 232, 124, 0.8));">i</span>S
        </div>
        <div class="intro-controls" id="introControls">
            <!-- Skill Level + Difficulty row (side-by-side on phones) -->
            <div class="intro-dropdowns-row">
                <div class="menu-dropdown-wrapper intro-dropdown-wrapper">
                    <div class="menu-dropdown-label" data-i18n="intro.skillLevel">Skill Level</div>
                    <button id="introSkillLevelBtn" class="menu-dropdown-btn">üåä Tempest</button>
                </div>
                <div class="menu-dropdown-wrapper intro-dropdown-wrapper">
                    <div class="menu-dropdown-label" data-i18n="mode.difficulty">Difficulty</div>
                    <button id="introDifficultyBtn" class="menu-dropdown-btn">‚õàÔ∏è Downpour</button>
                </div>
            </div>
            <!-- Challenge Mode(s) dropdown button -->
            <div class="menu-dropdown-wrapper intro-dropdown-wrapper">
                <div class="menu-dropdown-label" data-i18n="mode.challengeModes">Challenge Mode(s)</div>
                <button id="introChallengeBtn" class="menu-dropdown-btn" data-i18n="challenge.normal">Normal</button>
            </div>
            <div class="intro-toggles-row">
                <label class="intro-toggle">
                    <span class="intro-toggle-label" data-i18n="intro.music">Music</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="introMusicCheckbox" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </label>
                <label class="intro-toggle" id="introFullscreenToggle">
                    <span class="intro-toggle-label" data-i18n="intro.fullScreen">Full Screen</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="introFullscreenCheckbox">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
            </div>
            <button class="start-game-btn" id="startGameBtn" data-i18n="intro.startGame">‚ñ∂ Start Game</button>
            <div id="fullscreenHint" style="display: none; margin-top: max(1.5vh, 12px); padding: 8px 12px; background: rgba(255, 215, 0, 0.15); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 6px; font-size: 12px; color: #FFD700; text-align: center; line-height: 1.4; white-space: nowrap;"></div>
        </div>
    </div>
    <canvas id="starfield"></canvas>
    <button class="settings-btn" id="settingsBtn" data-i18n="settings.title">‚öôÔ∏è Settings</button>
    <div class="header"></div>

    <div class="content-area">
        <div class="game-container">
        <div class="rules-panel">
            <div class="rules-header" style="display: flex; justify-content: center; align-items: center; margin-bottom: 0.5vh;">
                <select id="rulesPanelViewSelect" style="background: rgba(0,0,0,0.5); color: #fff; border: 1px solid #555; border-radius: 4px; padding: 0.4vh 0.8vw; font-size: max(1.5vh, 12px); width: auto; text-align: left; text-align-last: center;">
                    <option value="rules" selected data-i18n="rules.howToPlay">üìñ How to Play</option>
                    <option value="leaderboard-normal" data-i18n="rules.leaderboardNormal">üèÜ Normal</option>
                    <option value="leaderboard-challenge" data-i18n="rules.leaderboardChallenge">üèÜ Challenge</option>
                    <option value="leaderboard-ai" data-i18n="rules.leaderboardAI">ü§ñ AI Mode</option>
                    <option value="leaderboard-ai-challenge" data-i18n="rules.leaderboardAIChallenge">ü§ñ AI Challenge</option>
                </select>
            </div>
            <div class="rules-instructions">
                
                <div class="rules-section">
                    <h3 data-i18n="rules.goalTitle">üéÆ Goal</h3>
                    <span id="rulesGoalText" data-i18n-html="rules.goal">Stack colored blocks to form <i>blobs</i> (connected groups of a single color). Clear rows to break up blobs and score: the larger the blob, the more points you get for ripping it apart!
					But watch out for <i>tornadoes</i> and <i>earthquakes</i>!</span>
                </div>
                
                <div class="rules-section">
                    <h3 data-i18n="rules.specialEventsTitle">‚ú® Special Events</h3>
                    <div data-i18n-html="rules.strike">
						<strong>‚ö° Strike:</strong> Clear 4 rows at once for 2√ó points!
                    </div>
                    <div id="rulesTsunamiSection" data-i18n-html="rules.tsunami">
						<strong>üåä Tsunami:</strong> Create a blob that spans the full width of the well and the <i>entire</i> blob clears for massive points!
                    </div>
                    <div id="rulesVolcanoSection" data-i18n-html="rules.volcano">
						<strong>üåã Volcano:</strong> When a blob touching any edge is surrounded by another blob and the edge, it turns to lava, erupting upward and raining down as single blocks. Each lava segment cleared multiplies the line clear by 2<sup>n</sup> (1 segment = 2√ó, 2 segments = 4√ó, 3 segments = 8√ó)!
                    </div>
					<div style="padding: 0" id="rulesBlackHoleSection" data-i18n-html="rules.blackHole">
						<strong>üï≥Ô∏è Black Hole:</strong> When one blob completely envelops another, the inner blob becomes a black hole that sucks in <i>all</i> blocks from both blobs for huge points!
					</div>
                </div>
                
                <div class="rules-section">
                    <h3 data-i18n="rules.scoringTitle">üìä Scoring</h3>
                    <div data-i18n-html="rules.levelExplain">
						<strong>Level:</strong> Increases as you clear lines (every 11 lines = +1 level). Higher levels mean faster falling pieces and higher score multipliers!
                    </div>
                    <div>
						<span data-i18n-html="rules.scoringNormal"><strong>Normal:</strong> (Blob Size)¬≤ √ó Blocks Cleared √ó 100 √ó Level</span>
						<ul>
							<li data-i18n="rules.scoringBigger">Bigger blobs = exponentially more points!</li>
						</ul>
					</div>
                    <div data-i18n-html="rules.scoringStrike">
						<strong>Strike:</strong> 2√ó all points
                    </div>
                    <div id="rulesTsunamiScoring" data-i18n-html="rules.scoringTsunami">
						<strong>Tsunami:</strong> (Blob Size)¬≥ √ó 200 √ó Level
                    </div>
					<div id="rulesVolcanoScoring">
						<span data-i18n-html="rules.scoringVolcano"><strong>Volcano:</strong></span>
						<ul>
							<li data-i18n-html="rules.scoringVolcanoInner">Inner (lava): (Blob Size)¬≥ √ó 500 √ó Level</li>
							<li data-i18n-html="rules.scoringVolcanoLava">Lava in lines: 2<sup>n</sup> multiplier (n = # of lava segments)</li>
						</ul>
					</div>
					<div id="rulesBlackHoleScoring">
						<span data-i18n-html="rules.scoringBlackHole"><strong>Black Hole:</strong></span>
						<ul>
							<li data-i18n-html="rules.scoringBHInner">Inner (core): (Blob Size)¬≥ √ó 800 √ó Level</li>
							<li data-i18n-html="rules.scoringBHOuter">Outer (sucked in): (Blob Size)¬≥ √ó 800 √ó Level</li>
						</ul>
					</div>
					<div style="padding: 0" id="rulesSpeedBonusText" data-i18n-html="rules.speedBonus">
						<strong>Speed Bonus:</strong> The faster you drop pieces, the larger the bonus applied to your score.  But beware: faster drops also mean more frequent <i>tornadoes</i> and <i>earthquakes</i>!
					</div>
                </div>
            </div>
            
            <!-- Histogram Canvas -->
            <canvas id="histogramCanvas" class="histogram-canvas"></canvas>
            
            <!-- Planet Stats in Left Panel (Tablet Mode) -->
            <div id="planetStatsLeft">
                <div id="planetStatsLeftContent"></div>
            </div>
        </div>
        
        <div class="main-area">
            <div id="vertigoWrapper">
            <canvas id="gameCanvas" width="350" height="700"></canvas>
            </div>
            <div class="mode-menu" id="modeMenu">
                <div class="well-title" id="title-tantris" style="display: none;">
                    T<span style="-webkit-text-fill-color: #FFE87C; color: #FFE87C; background: none; filter: drop-shadow(0 0 0.3vh rgba(255, 232, 124, 0.8));">a</span>NT<span style="-webkit-text-fill-color: #FFA500; color: #FFA500; background: none;">–Ø</span><span style="-webkit-text-fill-color: #FFE87C; color: #FFE87C; background: none; filter: drop-shadow(0 0 0.3vh rgba(255, 232, 124, 0.8));">i</span>S
                </div>
                
                <div class="menu-dropdown-group">
                    <!-- Skill Level dropdown button -->
                    <div class="menu-dropdown-wrapper">
                        <div class="menu-dropdown-label" data-i18n="intro.skillLevel">Skill Level</div>
                        <button id="skillLevelMenuBtn" class="menu-dropdown-btn">üåä Tempest</button>
                    </div>

                    <!-- Difficulty dropdown button -->
                    <div class="menu-dropdown-wrapper">
                        <div class="menu-dropdown-label" data-i18n="mode.difficulty">Difficulty</div>
                        <button id="difficultyMenuBtn" class="menu-dropdown-btn">‚õàÔ∏è Downpour</button>
                    </div>

                    <!-- Challenge Mode(s) dropdown button -->
                    <div class="menu-dropdown-wrapper">
                        <div class="menu-dropdown-label" data-i18n="mode.challengeModes">Challenge Mode(s)</div>
                        <button id="challengeSelectBtn" class="menu-dropdown-btn" data-i18n="challenge.normal">Normal</button>
                    </div>

                    <!-- START GAME button -->
                    <button class="menu-start-game-btn" id="menuStartGameBtn" data-i18n="intro.startGame">‚ñ∂ START GAME</button>
                </div>

                <!-- Hidden mode buttons for compatibility with existing JS -->
                <div style="display:none;">
                    <button class="mode-button" data-mode="drizzle">Drizzle</button>
                    <button class="mode-button" data-mode="downpour">Downpour</button>
                    <button class="mode-button" data-mode="hailstorm">Hailstorm</button>
                    <button class="mode-button" data-mode="blizzard">Blizzard</button>
                    <button class="mode-button" data-mode="hurricane">Hurricane</button>
                </div>

            </div>
            <div class="game-over" id="gameOver">
                <div style="font-size: 32px; margin-bottom: 10px;" data-i18n="gameOver.title">GAME OVER</div>
                <div id="finalScore"></div>
                <div id="finalStats" style="margin-top: 10px; font-size: 16px; color: rgba(255,255,255,0.8); white-space: nowrap;"></div>
                <div class="gameover-share-row" id="gameOverShareRow">
                    <a class="gameover-share-icon" id="goShareTwitter" href="#" target="_blank" rel="noopener" title="Share on X">
                        <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    </a>
                    <a class="gameover-share-icon" id="goShareFacebook" href="#" target="_blank" rel="noopener" title="Share on Facebook">
                        <svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                    </a>
                    <a class="gameover-share-icon" id="goShareReddit" href="#" target="_blank" rel="noopener" title="Share on Reddit">
                        <svg viewBox="0 0 24 24"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
                    </a>
                    <a class="gameover-share-icon" id="goShareWhatsApp" href="#" target="_blank" rel="noopener" title="Share on WhatsApp">
                        <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    </a>
                    <a class="gameover-share-icon" id="goShareTelegram" href="#" target="_blank" rel="noopener" title="Share on Telegram">
                        <svg viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                    </a>
                    <a class="gameover-share-icon" id="goShareCopyLink" href="#" title="Copy Link">
                        <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                    </a>
                </div>
                <button id="playAgainBtn" data-i18n="gameOver.playAgain">Play Again</button>
            </div>
            
            <!-- Share Popup -->
            <div class="share-overlay" id="shareOverlay">
                <div class="share-popup">
                    <button class="share-close" id="shareCloseBtn">&times;</button>
                    <div class="share-emoji">üöÄ</div>
                    <div class="share-title" data-i18n="share.title">ENJOYING THE GAME?</div>
                    <div class="share-subtitle" data-i18n-html="share.subtitle">Share TaNT–ØiS with your friends and<br>see who can top the leaderboard!</div>
                    <div class="share-grid">
                        <a class="share-btn x-twitter" id="shareTwitter" href="#" target="_blank" rel="noopener" title="Share on X">
                            <svg viewBox="0 0 24 24" fill="#c0c8d8"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                            <span>X</span>
                        </a>
                        <a class="share-btn facebook" id="shareFacebook" href="#" target="_blank" rel="noopener" title="Share on Facebook">
                            <svg viewBox="0 0 24 24" fill="#c0c8d8"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                            <span>Facebook</span>
                        </a>
                        <a class="share-btn reddit" id="shareReddit" href="#" target="_blank" rel="noopener" title="Share on Reddit">
                            <svg viewBox="0 0 24 24" fill="#c0c8d8"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
                            <span>Reddit</span>
                        </a>
                        <a class="share-btn whatsapp" id="shareWhatsApp" href="#" target="_blank" rel="noopener" title="Share on WhatsApp">
                            <svg viewBox="0 0 24 24" fill="#c0c8d8"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                            <span>WhatsApp</span>
                        </a>
                        <a class="share-btn telegram" id="shareTelegram" href="#" target="_blank" rel="noopener" title="Share on Telegram">
                            <svg viewBox="0 0 24 24" fill="#c0c8d8"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                            <span>Telegram</span>
                        </a>
                        <a class="share-btn copy-link" id="shareCopyLink" href="#" title="Copy Link">
                            <svg viewBox="0 0 24 24" fill="#c0c8d8"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            <span data-i18n="share.copyLink">Copy Link</span>
                        </a>
                    </div>
                    <button class="share-dismiss" id="shareDismissBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
                        <span data-i18n="share.dontShowAgain">Don't show this again</span>
                    </button>
                </div>
            </div>
            <div class="credits-overlay" id="creditsOverlay">
                <div class="credits-scroll" id="creditsScroll">
                    <div class="credits-content">
                        <div class="credits-title" id="gameTitle">T<span class="credits-ai">a</span>NT–Ø<span class="credits-ai">i</span>S</div>
                        
                        <div class="credits-section">
                            <div class="credits-row">
                                <span class="credits-role">Game Design</span>
                                <span class="credits-name">C. Ryan Deardorff</span>
                            </div>
                        </div>
                        
                        <div class="credits-section">
                            <div class="credits-row">
                                <span class="credits-role">Programming</span>
                                <span class="credits-name">Claude AI (Anthropic)</span>
                            </div>
                            <div class="credits-row">
                                <span class="credits-role"></span>
                                <span class="credits-name">C. Ryan Deardorff</span>
                            </div>
                        </div>
                        
                        <div class="credits-section">
                            <div class="credits-row">
                                <span class="credits-role">Music</span>
                                <span class="credits-name">SUNO AI</span>
                            </div>
                        </div>
                        
                        <div class="credits-section">
                            <div class="credits-row">
                                <span class="credits-role">"Cascade into the Void" Lyrics</span>
                                <span class="credits-name">Claude AI</span>
                            </div>
                            <div class="credits-row">
                                <span class="credits-role"></span>
                                <span class="credits-name">C. Ryan Deardorff</span>
                            </div>
                        </div>
                        
                        <div class="credits-section">
                            <div class="credits-row">
                                <span class="credits-role">"The Pit" Lyrics</span>
                                <span class="credits-name">Andy Dwyer</span>
                            </div>
                        </div>
                        
                        <div class="credits-section">
                            <div class="credits-row">
                                <span class="credits-role">Catering</span>
                                <span class="credits-name">Your Mom</span>
                            </div>
                        </div>
                        
                        <div class="credits-section">
                            <div class="credits-row">
                                <span class="credits-role">Obligatory Thanks</span>
                                <span class="credits-name">Sir Daniel Teater</span>
                            </div>
                            <div class="credits-row">
                                <span class="credits-role"></span>
                                <span class="credits-name">David Koch</span>
                            </div>
                        </div>
                        
                        <div class="credits-thanks">Special Thanks to Josh Cadotte</div>
                        
                        <div class="soundtrack-section">
                            <div class="soundtrack-heading">Soundtrack Available On</div>
                            <div class="soundtrack-title">Music from the Motion Blocks Game TaNT–ØiS</div>
                            <div class="soundtrack-links">
                                <a href="https://open.spotify.com/album/2bOWsC0XXpXBzeJ09MzQmz" target="_blank" class="soundtrack-link">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>
                                    Spotify
                                </a>
                                <a href="https://music.apple.com/us/album/music-from-the-motion-blocks-game-tant%D1%8Fis/1873633522" target="_blank" class="soundtrack-link">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043A5.022 5.022 0 0019.7.197C18.976.044 18.245 0 17.51 0h-11c-.736 0-1.468.044-2.193.197a5.022 5.022 0 00-1.874.694C1.326 1.627.58 2.63.264 3.937a9.23 9.23 0 00-.24 2.19C.004 6.636 0 7.147 0 7.658v8.685c0 .51.004 1.02.024 1.53a9.23 9.23 0 00.24 2.19c.317 1.31 1.062 2.31 2.18 3.043.39.257.82.456 1.28.597.728.153 1.46.197 2.197.197h11c.737 0 1.47-.044 2.198-.197a5.023 5.023 0 001.28-.597c1.118-.733 1.863-1.733 2.18-3.043a9.23 9.23 0 00.24-2.19c.02-.51.024-1.02.024-1.53V7.658c0-.51-.004-1.022-.024-1.534zM16.95 17.08c0 .36-.062.71-.19 1.05a2.58 2.58 0 01-1.468 1.478 2.083 2.083 0 01-.834.168c-.15 0-.3-.015-.45-.045a2.933 2.933 0 01-.87-.334 2.093 2.093 0 01-.92-1.09 2.18 2.18 0 01-.14-.76c0-.34.066-.673.198-.998a2.52 2.52 0 011.468-1.438 2.77 2.77 0 011.134-.233c.15 0 .3.017.45.05.33.072.637.2.87.335V10.5a.448.448 0 00-.03-.17.268.268 0 00-.14-.14.64.64 0 00-.24-.06L9.608 11.28a.64.64 0 00-.24.06.268.268 0 00-.14.14.448.448 0 00-.03.17v6.36c0 .36-.062.71-.19 1.05a2.582 2.582 0 01-1.468 1.477 2.083 2.083 0 01-.834.168c-.15 0-.3-.015-.45-.045a2.933 2.933 0 01-.87-.334 2.093 2.093 0 01-.92-1.09 2.18 2.18 0 01-.14-.76c0-.34.066-.673.198-.998a2.52 2.52 0 011.468-1.438 2.77 2.77 0 011.134-.233c.15 0 .3.017.45.05.33.072.637.2.87.335V7.208c0-.28.057-.533.17-.762a1.03 1.03 0 01.498-.473 2.4 2.4 0 01.68-.192l6.7-1.2a2.4 2.4 0 01.68.008c.22.04.41.13.56.27.15.14.248.32.293.54.026.12.037.25.037.38v11.1z"/></svg>
                                    Apple Music
                                </a>
                            </div>
                        </div>
                        
                        <div class="credits-spacer"></div>
                        
                        <div class="credits-disclaimer">No animals were harmed in the making of this game.</div>
                        
                        <div class="credits-spacer"></div>
                        
                        <div class="credits-copyright">¬© 2026 Official Intelligence</div>
                        <a href="https://official-intelligence.art/" class="credits-link">https://official-intelligence.art/</a>
                        
                        <div class="credits-spacer-large"></div>
                        
                        <div class="credits-spacer-large"></div>
                        
                        <div class="credits-easter">You're still here?</div>
                        
                        <div class="credits-spacer"></div>
                        
                        <div class="credits-easter">The game is over.  Play another one!</div>
						
						<div class="credits-spacer-large"></div>
						
						<div class="credits-disclaimer">
							Full disclosure, a m√∏√∏se <i>was</i> nearly decapitated during the launch party when the caterer started choking on a penny that 
							had fallen into the crab dip and she spun frantically into a mime, pushing him out of his box and into the pool, causing the lifeguard to leap off of his tower, which
							wasn't securely fastened and tipped over onto the m√∏√∏se.
						</div>
                        
                        <div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">
							Fortunately the m√∏√∏se had a premonition about the disaster, and stomped on the mime before he could climb into his box.
						</div>
                        
                        <div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">
							The mime was severly maimed and is now suing the m√∏√∏se.
						</div>
                        
                        <div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">
							The caterer should not have been eating the crab dip, and has been sacked.
						</div>
                        
                        <div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">
							The m√∏√∏se is convinced that Death is still coming for him, and refuses to set foot outside of his trailer.
						</div>
						
						<div class="credits-spacer-final"></div>
						
						<div class="credits-disclaimer">
							<p>You're probably wondering if aliens are real.  Despite popular belief, the Grays are <i>not</i> extraterrestrial‚Äîthey are, in fact, very much of this earth.  The reason they
							appear so "humanoid" is because they are our great great great great ancestors who once thrived in an advanced civilization up here on the land.</p>
							<p>Having become so advanced, they realized that it would inevitably become futile to continue living out in the open, exposed to all kinds of natural disasters that would only 
							grow more severe.  They knew that the entire planet would eventually become engulfed in water, and so decided to learn how to thrive deep in the ocean.</p>
							<p>They are well aware of our existence, and are not amused by our shenanegans.  The one exception being <i>Malcolm in the Middle</i>, which nearly brought about "Disclosure Day"
							when it ended.  But they knew we weren't ready for that yet, and instead have been working tirelessly behind the scenes to bring about the reboot.</p>
						</div>
                        
                        <div class="credits-spacer-final"></div>
						
						<div class="credits-disclaimer">My imaginary friend is a Muppet.</div>
                        
                        <div class="credits-spacer"></div>
                        
                        <div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">Jealous?</div>
						
						<div class="credits-spacer"></div>
                        
                        <div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">Though he may look like one, the last guy who called him a Fraggle is now in the ICU.</div>
						
						<div class="credits-spacer"></div>
                        
                        <div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">The doctors had to remove Jimmy's fist from his ass.</div>
                        
                        <div class="credits-spacer-final"></div>
						
						<div class="credits-disclaimer">
							<div class="credits-thanks">Spontaneous Human Consumption</div>
							<p>The group that stepped off the bus consisted of two women and seven men; the tenth person was shot immediately, so it didn't really matter
							what sex it was, although Herbert was rather interested.</p>
							<p>After the shot went off, Herbert was seen standing over the dead body.  This led the rest to believe that he was the one who had done the deed, but since nobody really cared
							one way or the other, they didn't hold it against him.</p>
							<p>A silence fell among the group as they dragged the dead body into a nearby alley and propped it in a sitting position against the wall.  Had it not been Tuesday, they all would
							have left it at that and then gone their separate ways.  But it <i>was</i> Tuesday, and they all knew what had to be done.</p>
							<p>Herbert had the honor of taking the first bite.  He cringed at the taste, and then managed to smile.  The younger of the two women took the next bite‚Äîfrom the nose.  Pretty
							soon everyone had a bite, and the silence diminished as they feasted on the corpse.</p>
							<p>It took close to three hours to devour the entire body, and when the task was accomplished, they all went back to their normal lives.</p>
							<p>That night Herbert let out a burp that smelled like perfume.  For the first time in ten years his wife did not come to bed with him.  She slept in the bathtub on a bed
							of crackers.</p>
						</div>
                        
                        <div class="credits-spacer-final"></div>
						
						<div class="credits-disclaimer">I must away now, as they are handing out the meds and Jimmy gets super weird if I don't take mine.</div>
						
						<div class="credits-spacer"></div>
						
						<div class="credits-disclaimer">Tell your dog I said hi.</div>
                        
                        <div class="credits-spacer-final"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="side-panel">
            <div class="score-display">
                <div class="score-label" data-i18n="panel.score">Score</div>
                <div id="score">0</div>
            </div>
            <div class="score-display">
                <div class="score-label" data-i18n="panel.lines">Lines</div>
                <div id="lines">0</div>
            </div>
            <div class="score-display">
                <div class="score-label" data-i18n="panel.level">Level</div>
                <div id="level">1</div>
            </div>
            <div class="next-piece" id="nextPieceSection">
                <div class="score-label" data-i18n="panel.nextPieces">Next Pieces</div>
                <div class="next-canvas-wrapper">
                    <canvas id="nextCanvas" class="next-canvas"></canvas>
                </div>
            </div>
            
            <!-- Special Events Grid (2 columns) -->
            <div class="special-events-grid">
                <div class="score-display" id="strikesRow">
                    <div class="score-label" data-i18n="stats.strikes">‚ö° Strikes</div>
                    <div id="strikes">0</div>
                </div>
                <div class="score-display" id="blackholesRow">
                    <div class="score-label" data-i18n="stats.blackHoles">üï≥Ô∏è Black Holes</div>
                    <div id="blackholes">0</div>
                </div>
                <div class="score-display" id="tsunamisRow">
                    <div class="score-label" data-i18n="stats.tsunamis">üåä Tsunamis</div>
                    <div id="tsunamis">0</div>
                </div>
                <div class="score-display" id="volcanoesRow">
                    <div class="score-label" data-i18n="stats.volcanoes">üåã Volcanoes</div>
                    <div id="volcanoes">0</div>
                </div>
            </div>
            
            <!-- Bottom section - pushed to bottom of panel -->
            <div class="side-panel-bottom">
                <!-- Controls and Planet Stats occupy the same space -->
                <div class="controls">
                    <div><span class="control-key">‚Üê ‚Üí :</span><span data-i18n="controls.move">Move</span></div>
                    <div><span class="control-key">‚Üì :</span><span data-i18n="controls.softDrop">Soft Drop</span></div>
                    <div><span class="control-key">‚Üë :</span><span data-i18n="controls.rotateCW">Rotate CW</span></div>
                    <div><span class="control-key">Space :</span><span data-i18n="controls.hardDrop">Hard Drop</span></div>
                    <div><span class="control-key">P :</span><span data-i18n="controls.pause">Pause</span></div>
                    <div><span class="control-key">PgUp/PgDn :</span><span data-i18n="controls.toggleFullscreen">Toggle Fullscreen</span></div>
                    <div style="margin-top: 10px;"><span class="control-key">Numpad 4/6 :</span><span data-i18n="controls.move">Move</span></div>
                    <div><span class="control-key">Numpad 2 :</span><span data-i18n="controls.softDrop">Soft Drop</span></div>
                    <div><span class="control-key">Numpad 5 :</span><span data-i18n="controls.rotateCCW">Rotate CCW</span></div>
                    <div><span class="control-key">Numpad 0 :</span><span data-i18n="controls.hardDrop">Hard Drop</span></div>
                </div>
                
                <!-- Planet Stats Display - Appears in same location as controls during gameplay -->
                <div id="planetStats" style="display: none; margin-top: 1.8vh; padding: 1vh 0.9vw; background: rgba(26, 26, 46, 0.8); border-radius: 0.6vh; border: 1px solid rgba(255, 255, 255, 0.1); font-size: 1.5vh; color: #ccc;">
                    <div id="planetStatsContent"></div>
                </div>
                
                <!-- Touch Controls for Tablet Mode -->
                <div id="touchControls">
                    <button class="touch-btn touch-btn-rotate-ccw" id="touchRotateCCW">‚Ü∫</button>
                    <button class="touch-btn touch-btn-left" id="touchLeft">‚¨Ö</button>
                    <button class="touch-btn touch-btn-rotate" id="touchRotate">‚Üª</button>
                    <button class="touch-btn touch-btn-right" id="touchRight">‚û°</button>
                    <button class="touch-btn touch-btn-down" id="touchDown">‚¨á</button>
                    <button class="touch-btn touch-btn-drop" id="touchDrop">‚¨á‚¨á</button>
                </div>
                <div id="gestureGuide" style="display: none; font-size: max(1.3vh, 10px); color: #aaa; padding: 0.5vh 0;">
                    <div style="color: #ddd; font-weight: bold; margin-bottom: 0.5vh; text-align: center;">Touch Controls</div>
                    <div style="display: inline-grid; grid-template-columns: auto auto; gap: 0.2vh 0.5vw; text-align: left;">
                        <div style="text-align: right;">üëÜ Tap left:</div><div>Rotate ‚Ü∫</div>
                        <div style="text-align: right;">üëÜ Tap right:</div><div>Rotate ‚Üª</div>
                        <div style="text-align: right;">üëàüëâ Swipe:</div><div>Move</div>
                        <div style="text-align: right;">üëá Swipe down:</div><div>Hard Drop</div>
                        <div style="text-align: right;">üëá Hold down:</div><div>Soft Drop</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    
    <!-- Pause Button (shown in top-right during tablet mode gameplay) -->
    <button class="pause-btn" id="pauseBtn">‚è∏Ô∏è</button>
    
    <!-- Settings Popup -->
    <div class="settings-overlay" id="settingsOverlay">
        <div class="settings-popup">
            <div class="settings-title" data-i18n="settings.title">‚öôÔ∏è Settings</div>
            
            <div class="settings-columns">
                <div class="settings-column-left">
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text" data-i18n="settings.music">Music</span>
                    <select id="musicSelect" style="background: rgba(0,0,0,0.5); color: #fff; border: 1px solid #555; border-radius: 4px; padding: 6px 10px; font-size: 13px; margin-left: auto; width: 270px;">
                        <option value="shuffle" data-i18n="music.shuffle">üé≤ Shuffle</option>
                        <option value="none" data-i18n="music.none">üîá None</option>
                        <!-- Populated dynamically from audio.js -->
                    </select>
                </label>
            </div>
            
            <div class="settings-divider"></div>
            
            <div class="settings-option" style="border-bottom: none; position: relative;">
                <div class="toggle-label">
                    <span class="toggle-label-text"><span class="label-full" data-i18n="settings.colorPalette">Color Palette</span><span class="label-short" data-i18n="settings.colorPaletteShort">Colors</span></span>
                    <div class="palette-dropdown" id="paletteDropdown" style="margin-left: auto;">
                        <button type="button" class="palette-dropdown-button" id="paletteDropdownBtn">
                            <div style="display: flex; align-items: center; gap: 6px; overflow: hidden;">
                                <div class="palette-color-row" id="palettePreview">
                                    <!-- Colors populated by JS -->
                                </div>
                                <span id="paletteNameDisplay" style="font-size: 12px; color: #aaa; white-space: nowrap;">Classic</span>
                            </div>
                            <span style="font-size: 10px; color: #888;">‚ñº</span>
                        </button>
                        <div class="palette-dropdown-menu" id="paletteDropdownMenu">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-option">
                <label style="display: block; margin-bottom: 2px;">
                    <span data-i18n="settings.pieceOpacity">Piece Opacity:</span> <span id="opacityDisplay" style="color: #aaa;">42%</span>
                </label>
                <input type="range" id="opacitySlider" min="0" max="100" step="1" value="42" 
                       style="width: 100%; cursor: pointer;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: #888; margin-top: 4px;">
                    <span data-i18n="settings.transparent">Transparent</span>
                    <span data-i18n="settings.opaque">Opaque</span>
                </div>
            </div>
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text" data-i18n="settings.stormEffects">Background Storm Effects</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="stormEffectsToggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </label>
                <div class="settings-desc" style="font-size: 11px; color: #888; margin-top: 4px; margin-left: 48px;" data-i18n="settings.stormEffects.desc">
                    Shows rain/sleet/snow in the background.
                </div>
            </div>
            
            <div class="settings-option">
                <label class="toggle-label">
                    <span class="toggle-label-text" data-i18n="settings.reverseCamera">Reverse Camera</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="cameraOrientationToggle">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
                <div class="settings-desc" style="font-size: 11px; color: #888; margin-top: 4px; margin-left: 48px;" data-i18n="settings.reverseCamera.desc">
                    Sun is behind, planets move toward the camera instead of away from it.
                </div>
            </div>
            
            <div class="settings-option">
                <label style="display: block; margin-bottom: 2px;" data-i18n="settings.starfieldSpeed">
                    Starfield Speed
                </label>
                <input type="range" id="starSpeedSlider" min="0" max="4" step="0.5" value="1" 
                       style="width: 100%; cursor: pointer;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: #888; margin-top: 4px;">
                    <span data-i18n="settings.offSlow">Off/Slow</span>
                    <span data-i18n="settings.fast">Fast</span>
                </div>
            </div>
            
            <div class="settings-option" id="minimalistOption">
                <label class="toggle-label">
                    <span class="toggle-label-text" data-i18n="settings.minimalist">Minimalist Mode</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="minimalistToggle">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
                <div class="settings-desc" style="font-size: 11px; color: #888; margin-top: 4px; margin-left: 48px;" data-i18n="settings.minimalist.desc">
                    Hides UI, transparent well, alternate Sun
                </div>
            </div>
            
            <div class="settings-option" id="aiModeOption" style="border-bottom: none;">
                <label class="toggle-label">
                    <span class="toggle-label-text" data-i18n="settings.aiMode">ü§ñ AI Mode</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="aiModeToggle">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
                <div class="settings-desc" style="font-size: 11px; color: #888; margin-top: 4px; margin-left: 48px;" data-i18n="settings.aiMode.desc">
                    Let Claude play the game automatically
                </div>
            </div>
            
            <div class="settings-option" id="aiSpeedOption" style="display: none; border-bottom: none;">
                <label style="display: block; margin-bottom: 2px;" data-i18n="settings.aiSpeed">
                    AI Speed
                </label>
                <input type="range" id="aiSpeedSlider" min="1" max="10" step="1" value="5" 
                       style="width: 100%; cursor: pointer;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: #888; margin-top: 4px;">
                    <span data-i18n="settings.slow">Slow</span>
                    <span data-i18n="settings.fast">Fast</span>
                </div>
            </div>
            
            <div class="settings-divider"></div>
            
            <div class="settings-option" style="border-bottom: none;">
                <label class="toggle-label">
                    <span class="toggle-label-text" data-i18n="settings.language">Language</span>
                    <select id="languageSelect" style="background: rgba(0,0,0,0.5); color: #fff; border: 1px solid #555; border-radius: 4px; padding: 6px 10px; font-size: 13px; margin-left: auto; width: 270px;">
                        <!-- Populated by i18n.js -->
                    </select>
                </label>
            </div>
            
                </div><!-- end settings-column-left -->
                
                <div class="settings-column-right">
            <!-- Controls Configuration Section -->
            <div class="controls-config-section">
                <div class="controls-config-title" data-i18n="controls.title">üéÆ Controls</div>
                <div id="controlsConfigContainer">
                    <!-- Populated by controls-config.js -->
                </div>
            </div>
                </div><!-- end settings-column-right -->
            </div><!-- end settings-columns -->
            
            <button class="settings-close-btn" id="settingsCloseBtn" data-i18n="settings.close">Close</button>
        </div>
    </div>

    <!-- Skill Level Modal -->
    <div class="combo-modal-overlay" id="skillLevelModalOverlay">
        <div class="combo-modal selection-modal">
            <div class="combo-modal-title" data-i18n="intro.skillLevel">üéÆ Skill Level</div>
            <div class="selection-options-list">
                <div class="selection-option" data-skill="breeze">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="skill.breeze.full">üå•Ô∏è Breeze</span>
                    </div>
                    <ul class="selection-option-bullets" data-i18n-html="skill.breeze.modal"><li>Larger color blobs = bigger points</li></ul>
                </div>
                <div class="selection-option" data-skill="tempest">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="skill.tempest.full">üåä Tempest</span>
                    </div>
                    <ul class="selection-option-bullets" data-i18n-html="skill.tempest.modal"><li>Larger color blobs = bigger points</li><li>Tsunamis and Black Holes = huge points</li></ul>
                </div>
                <div class="selection-option" data-skill="maelstrom">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="skill.maelstrom.full">üå™Ô∏è Maelstrom</span>
                    </div>
                    <ul class="selection-option-bullets" data-i18n-html="skill.maelstrom.modal"><li>Larger color blobs = bigger points</li><li>Tsunamis, Black Holes and Volcanoes = huge points</li><li>Survive tornadoes and earthquakes</li></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Difficulty Modal -->
    <div class="combo-modal-overlay" id="difficultyModalOverlay">
        <div class="combo-modal selection-modal">
            <div class="combo-modal-title" data-i18n="mode.difficulty">üå¶Ô∏è Difficulty</div>
            <div class="selection-options-list">
                <div class="selection-option" data-mode="drizzle">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="mode.drizzle">üåßÔ∏è Drizzle</span>
                    </div>
                    <div class="challenge-description" data-i18n="mode.drizzle.tooltip">Easy mode ‚Äî 4 colors, standard 10-wide board</div>
                </div>
                <div class="selection-option" data-mode="downpour">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="mode.downpour">‚õàÔ∏è Downpour</span>
                    </div>
                    <div class="challenge-description" data-i18n="mode.downpour.tooltip">Standard mode ‚Äî 6 colors, 10-wide board</div>
                </div>
                <div class="selection-option" data-mode="hailstorm">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="mode.hailstorm">üßä Hailstorm</span>
                    </div>
                    <div class="challenge-description" data-i18n="mode.hailstorm.tooltip">Hard mode ‚Äî 8 colors for maximum challenge</div>
                </div>
                <div class="selection-option" data-mode="blizzard">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="mode.blizzard">‚ùÑÔ∏è Blizzard</span>
                    </div>
                    <div class="challenge-description" data-i18n="mode.blizzard.tooltip">Wide board ‚Äî 12-wide with some 5-block pieces, 5 colors</div>
                </div>
                <div class="selection-option" data-mode="hurricane">
                    <div class="selection-option-header">
                        <span class="selection-option-name" data-i18n="mode.hurricane">üåÄ Hurricane</span>
                    </div>
                    <div class="challenge-description" data-i18n="mode.hurricane.tooltip">Ultimate challenge ‚Äî 12-wide with more 5-block pieces, 7 colors</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Combo Challenge Modal -->
    <div class="combo-modal-overlay" id="comboModalOverlay">
        <div class="combo-modal">
            <div class="combo-modal-title" data-i18n="challenge.selectTitle">üéØ Select Challenge Combination</div>
            <div class="combo-bonus-display" id="comboBonusDisplay">
                <span data-i18n="challenge.scoreBonus">Score Bonus:</span> <span id="comboBonusPercent">0%</span>
            </div>
            
            <div class="combo-checkboxes-grid">
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboStranger" value="stranger">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Stranger (Upside Down) +7%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.stranger.desc">Entire screen rotates 180¬∞, pieces fall upward</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboPhantom" value="phantom">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Phantom (Invisible Stack) +7%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.phantom.desc">Stack fades out after each piece lands</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboRubber" value="rubber">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Rubber & Glue (Bouncing) +5%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.rubber.desc">Pieces bounce if they don't touch same-colored blobs</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboOz" value="oz">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Oz (Grayscale Until Landing) +5%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.oz.desc">Falling pieces are grayscale, reveal color on landing</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboThinner" value="thinner">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Thinner (Skinny Well) +4%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.thinner.desc">Blocks are half as wide, making a narrow well</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboThicker" value="thicker">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Thicker (Wide Well) +3%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.thicker.desc">Well is 2/3 height and 20% wider, creating a wide playing field</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboCarrie" value="carrie">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Carrie (Blood Rain) +3%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.carrie.desc">Blood rains down and runs down the stack</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboNokings" value="nokings">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>No Kings (Poo Rain) +3%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.nokings.desc">Poo rains down and runs down the stack</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboLongAgo" value="longago">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Long Ago... (Star Wars Perspective) +4%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.longago.desc">Well tilts back in 3D perspective like Star Wars opening</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboComingSoon" value="comingsoon">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Coming Soon... (Inverse Star Wars Perspective) +4%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.comingsoon.desc">Well tilts forward - pieces drop into distance</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboNervous" value="nervous">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Nervous (Vibrating Well) +2%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.nervous.desc">The entire well vibrates up and down constantly</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboSixSeven" value="sixseven">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Six Seven (???) +4%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.sixseven.desc">???</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboGremlins" value="gremlins">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Gremlins (Chaos Blocks) +6%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.gremlins.desc">Blocks randomly appear or disappear from the stack</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboLattice" value="lattice">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Lattice (Pre-filled Blocks) +5%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.lattice.desc">Start with random blocks in bottom half of well</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboYesAnd" value="yesand">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Yes, And... (Base Reality+) +5%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.yesand.desc">Pieces spawn random extra blocks when they land</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboMercurial" value="mercurial">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Mercurial (Color-Shifting Pieces) +4%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.mercurial.desc">Falling pieces randomly change color every 2-4 seconds</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboDyslexic" value="dyslexic">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Dyslexic (Reversed Controls) +6%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.dyslexic.desc">Left and right controls are swapped</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboShadowless" value="shadowless">
                        <span class="toggle-slider"></span>
                    </div>
                    <span>Shadowless (No Drop Preview) +2%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.shadowless.desc">Hides the shadow showing where pieces will land</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboAmnesia" value="amnesia">
                        <span class="toggle-slider"></span>
                    </div>
                    <span data-i18n="challenge.amnesia">Amnesia (Fading Colors) +6%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.amnesia.desc">Block colors slowly fade to white after placement, hiding their true color</div>
            </div>
            
            <div class="combo-checkbox-option">
                <label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="comboVertigo" value="vertigo">
                        <span class="toggle-slider"></span>
                    </div>
                    <span data-i18n="challenge.vertigo">Vertigo (Rocking Sway) +2%</span>
                </label>
                <div class="challenge-description" data-i18n="challenge.vertigo.desc">The game well slowly rocks, tilts, and sways like playing on a ship deck</div>
            </div>
			
            </div> <!-- End of combo-checkboxes-grid -->
            
            <div class="combo-buttons">            
				<div class="combo-modal-buttons">
					<button class="combo-modal-btn cancel" id="comboCancelBtn" data-i18n="challenge.cancel">Cancel</button>
					<button class="combo-modal-btn apply" id="comboApplyBtn" data-i18n="challenge.apply">Apply</button>
				</div>
			</div>
		</div>
    </div>
	
    <!-- Name Entry Modal (moved outside game-container for proper layout) -->
    <div class="name-entry-overlay" id="nameEntryOverlay">
        <div class="name-entry-popup">
            <div class="name-entry-title" data-i18n="nameEntry.title">üèÜ High Score! üèÜ</div>
            <div class="name-entry-message" data-i18n-html="nameEntry.message">
                Congratulations! Your score of <span class="name-entry-score" id="nameEntryScore"></span> 
                made it to the top 20!
                <br><br>
                Enter your name for the leaderboard:
            </div>
            <input type="text" 
                   id="nameEntryInput" 
                   class="name-entry-input" 
                   placeholder="Enter your name" 
                   data-i18n-placeholder="nameEntry.placeholder"
                   maxlength="20"
                   autocomplete="off"
                   inputmode="text"
                   enterkeyhint="done"
                   autocapitalize="words"
                   autocorrect="off">
            <button id="nameEntrySubmit" class="name-entry-button" data-i18n="nameEntry.submit">Submit Score</button>
        </div>
    </div>
    
    <!-- Login Modal (from auth.js) -->
    <div class="modal-overlay" id="loginModal">
        <div class="auth-modal">
            <button class="modal-close" onclick="hideLoginModal()">&times;</button>
            
            <h2 id="modalTitle">LOGIN</h2>
            
            <div class="error-message" id="loginError"></div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group" id="usernameGroup" style="display: none;">
                    <label>USERNAME</label>
                    <input type="text" id="username" name="username" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label>EMAIL</label>
                    <input type="email" id="email" name="email" required autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label>PASSWORD</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                
                <div style="text-align: right; margin-bottom: 15px;">
                    <a href="https://official-intelligence.art/reset-password" style="font-size: 12px; color: rgba(255,255,255,0.6);">Forgot password?</a>
                </div>
                
                <button type="submit" class="auth-submit-btn" id="submitBtn">ENTER</button>
            </form>
            
            <div class="auth-divider">OR</div>
            
            <div class="oauth-buttons">
                <a href="https://official-intelligence-api.onrender.com/auth/google/login" class="oauth-btn">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Continue with Google
                </a>
            </div>
            
            <div class="auth-footer">
                <span id="authToggleText">No account?</span>
                <a href="#" id="authToggle" onclick="toggleAuthMode(event)">Sign up</a>
            </div>
        </div>
    </div>
	
	<script src="config.js"></script>
	<script src="i18n.js"></script>
	<script src="auth.js"></script>
	<script src="leaderboard.js"></script>
	<script src="storm-effects.js"></script>
	<script src="render-utils.js"></script>
	<script src="audio.js"></script>
	<script src="starfield.js"></script>
	<script src="controls-config.js"></script>
	<script src="game-recorder.js"></script>
	<script src="challenge_amnesia.js"></script>
	<script src="challenge_gremlins.js"></script>
	<script src="challenge_lattice.js"></script>
	<script src="challenge_mercurial.js"></script>
	<script src="challenge_oz.js"></script>
	<script src="challenge_rubber.js"></script>
	<script src="challenge_phantom.js"></script>
	<script src="challenge_sixseven.js"></script>
	<script src="challenge_vertigo.js"></script>
	<script src="challenge_yesand.js"></script>
	<script src="histogram.js"></script>
	<script src="color-palettes.js"></script>
	<script src="ai-player.js"></script>
	<script src="replay.js"></script>
	<script src="touch-controls.js"></script>
	<script src="gamepad.js"></script>
	<script src="game.js"></script>
	<script src="settings-sync.js"></script>
	
	<script>
	// Populate music dropdowns from audio.js song lists
	(function() {
	    function populateMusicDropdowns() {
	        if (typeof AudioSystem === 'undefined' || !AudioSystem.getAllSongLists) {
	            console.warn('AudioSystem not ready, retrying...');
	            setTimeout(populateMusicDropdowns, 100);
	            return;
	        }

	        const songLists = AudioSystem.getAllSongLists();
	        const dropdowns = ['introMusicSelect', 'musicSelect'];
	        
	        dropdowns.forEach(dropdownId => {
	            const select = document.getElementById(dropdownId);
	            if (!select) return;
	            
	            // Add gameplay songs
	            songLists.gameplay.forEach(song => {
	                const option = document.createElement('option');
	                option.value = song.id;
	                option.textContent = song.name;
	                select.appendChild(option);
	            });
	            
	            // Add separator
	            const separator = document.createElement('option');
	            separator.disabled = true;
	            separator.textContent = '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ';
	            select.appendChild(separator);
	            
	            // Add menu song (TaNT–ØiS)
	            songLists.menu.forEach(song => {
	                const option = document.createElement('option');
	                option.value = song.id;
	                option.textContent = song.name;
	                select.appendChild(option);
	            });
	            
	            // Add credits songs (Cascade into the Void variations)
	            songLists.credits.forEach(song => {
	                const option = document.createElement('option');
	                option.value = song.id;
	                option.textContent = song.name;
	                select.appendChild(option);
	            });
	        });
	        
	        console.log('üéµ Music dropdowns populated with', songLists.gameplay.length, 'gameplay +', songLists.credits.length, 'credits +', songLists.menu.length, 'menu songs');
	    }
	    
	    // Run after DOM is ready
	    if (document.readyState === 'loading') {
	        document.addEventListener('DOMContentLoaded', populateMusicDropdowns);
	    } else {
	        populateMusicDropdowns();
	    }
	})();
	</script>

	<script>
	// Populate language dropdown from i18n.js
	(function() {
	    function populateLanguageDropdown() {
	        if (typeof I18n === 'undefined' || !I18n.getSupportedLanguages) {
	            setTimeout(populateLanguageDropdown, 100);
	            return;
	        }
	        
	        const select = document.getElementById('languageSelect');
	        if (!select) return;
	        
	        const languages = I18n.getSupportedLanguages();
	        const currentLang = I18n.getLanguage();
	        
	        select.innerHTML = '';
	        for (const [code, name] of Object.entries(languages)) {
	            const option = document.createElement('option');
	            option.value = code;
	            option.textContent = name;
	            if (code === currentLang) option.selected = true;
	            select.appendChild(option);
	        }
	        
	        select.addEventListener('change', (e) => {
	            I18n.setLanguage(e.target.value);
	        });
	    }
	    
	    if (document.readyState === 'loading') {
	        document.addEventListener('DOMContentLoaded', populateLanguageDropdown);
	    } else {
	        populateLanguageDropdown();
	    }
	})();
	</script>

<script>
if ('serviceWorker' in navigator) {
    let updateToastShown = false;

    function showUpdateToast(version) {
        if (updateToastShown) return;
        updateToastShown = true;
        console.log('üì¶ PWA: New version available' + (version ? ' (v' + version + ')' : ''));

        const toast = document.createElement('div');
        toast.textContent = 'Update available \u2014 tap to refresh';
        Object.assign(toast.style, {
            position: 'fixed',
            bottom: '12px',
            left: '50%',
            transform: 'translateX(-50%)',
            background: 'rgba(0, 150, 180, 0.9)',
            color: '#fff',
            padding: '10px 22px',
            borderRadius: '6px',
            fontSize: '14px',
            fontFamily: 'Arial, sans-serif',
            zIndex: '99999',
            pointerEvents: 'auto',
            cursor: 'pointer',
            opacity: '0',
            transition: 'opacity 0.3s',
            boxShadow: '0 2px 12px rgba(0,0,0,0.3)'
        });
        document.body.appendChild(toast);

        requestAnimationFrame(() => { toast.style.opacity = '1'; });

        toast.addEventListener('click', () => window.location.reload());

        // Auto-dismiss after 15 seconds
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 400);
        }, 15000);
    }

    // Primary: listen for explicit SW_UPDATED message (sent after activate + claim)
    navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'SW_UPDATED') {
            showUpdateToast(event.data.version);
        }
    });

    // Fallback: detect when a new SW takes control of this page
    navigator.serviceWorker.addEventListener('controllerchange', () => {
        showUpdateToast();
    });

    navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('üì¶ PWA: Service worker registered'))
        .catch(err => console.log('PWA: SW registration failed:', err));
}
</script>

</body>
</html>
